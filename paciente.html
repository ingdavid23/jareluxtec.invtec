<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarelux - Portal del Paciente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e40af 0%, #1e40af 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Se eliminan las clases .modal-backdrop y .modal-content del CSS para usar clases de Tailwind en JS */
        #video-call-modal .modal-content {
            height: 90vh;
            max-height: 700px;
        }

        /* Estilos de transici√≥n para el modal de chat */
        #luxi-chat-modal {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #luxi-chat-modal .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                      <div class="w-12 h-12  flex items-center justify-center p-1">
                        <img src="1000217146 (1).png" alt="Logo de Jarelux" class="w-full h-full object-contain">
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold">Jarelux</h1>
                        <p class="text-blue-100">Portal de Apoyo al Paciente</p>
                    </div>
                </div>
                <div id="userInfo" class="hidden">
                    <span id="userName" class="mr-4"></span>
                    <button onclick="logout()" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50">
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Bienvenido a Jarelux</h2>
                <p class="text-xl text-gray-600">Tu portal de salud y bienestar</p>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-8 card-hover cursor-pointer" onclick="showLogin('patient')">
                <div class="text-center">
                    <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <span class="text-4xl">ü§í</span>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Acceso Paciente</h3>
                    <p class="text-gray-600 mb-6">Consulta tu tratamiento, citas y recursos de apoyo.</p>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-blue-700">‚Ä¢ Historial m√©dico</p>
                        <p class="text-sm text-blue-700">‚Ä¢ Control de medicamentos</p>
                        <p class="text-sm text-blue-700">‚Ä¢ Apoyo emocional</p>
                    </div>
                </div>
            </div>
            <br>
                <div class="flex justify-center">
                    <button onclick="window.location.href='index.html';" class="bg-gradient-to-r from-blue-500 to-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 mb-4">
                        volver 
                    </button>
                </div>
            </br>
        </div>
    </div>

    

    <div id="loginForm" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h3 id="loginTitle" class="text-2xl font-bold text-gray-800 mb-2"></h3>
                <p class="text-gray-600">Ingresa tus credenciales</p>
            </div>
            
            <form onsubmit="handleLogin(event)">
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Usuario</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ingresa tu usuario" required>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Contrase√±a</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ingresa tu contrase√±a" required>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-300">
                    Iniciar Sesi√≥n
                </button>
            </form>
            
            <button onclick="backToSelection()" class="w-full mt-4 text-gray-600 hover:text-gray-800">
                ‚Üê Volver
            </button>
        </div>
    </div>

    <div id="patientDashboard" class="hidden">
        <div class="container mx-auto px-4 py-8">
            <nav class="bg-white rounded-lg shadow-md mb-8">
                <div class="flex flex-wrap justify-center space-x-1 p-2">
                    <button onclick="showPatientSection('overview', event)" class="patient-nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg m-1">üè† Inicio</button>
                    <button onclick="showPatientSection('appointments', event)" class="patient-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üìÖ Citas</button>
                    <button onclick="showPatientSection('medications', event)" class="patient-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üíä Medicamentos</button>
                    <button onclick="showPatientSection('history', event)" class="patient-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üìÇ Historial</button>
                    <button onclick="showPatientSection('support', event)" class="patient-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">‚ù§Ô∏è Apoyo</button>
                    <button onclick="showPatientSection('nutrition', event)" class="patient-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">ü•ó Nutrici√≥n</button>
                    <button onclick="showPatientSection('services', event)" class="patient-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üìç Servicios</button>
                </div>
            </nav>

            <div id="patient-overview" class="patient-section">
                    <div class="grid md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow-md card-hover text-center">
                            <h4 class="font-bold text-lg mb-2">Pr√≥xima Cita</h4>
                            <p class="text-3xl font-bold text-blue-600">15 Dic, 10:00 AM</p>
                            <p class="text-gray-600">Consulta de seguimiento con Dr. Mart√≠nez</p>
                            <button class="mt-3 bg-blue-100 text-blue-800 px-4 py-1 rounded-full text-sm">Ver detalles</button>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-md card-hover text-center">
                            <h4 class="font-bold text-lg mb-2">Medicamentos Hoy</h4>
                            <p class="text-3xl font-bold text-blue-600">3 Dosis Pendientes</p>
                            <p class="text-gray-600">Tamoxifeno, Ondansetr√≥n, Calcio</p>
                            <button class="mt-3 bg-blue-100 text-blue-800 px-4 py-1 rounded-full text-sm">Ver mi plan</button>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-md card-hover text-center">
                            <h4 class="font-bold text-lg mb-2">Mi Estado</h4>
                            <p class="text-3xl font-bold text-purple-600">Estable</p>
                            <p class="text-gray-600">Actualizado por Dr. Mart√≠nez</p>
                            <p class="text-xs text-gray-400 mt-3">Hoy, 2:30 PM</p>
                        </div>
                    </div>

                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-xl font-bold mb-4">Mi Plan del D√≠a</h3>
                    <div class="space-y-4">
                        <div class="flex items-center p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <span class="text-3xl mr-4">üíä</span>
                            <div>
                                <p class="font-semibold text-blue-800">8:00 AM - Tomar Tamoxifeno</p>
                                <p class="text-sm text-gray-600">1 tableta de 20mg con el desayuno.</p>
                            </div>
                            <button class="ml-auto bg-blue-600 text-white px-3 py-1 text-sm rounded-lg hover:bg-blue-700">Marcar como tomada</button>
                        </div>
                        <div class="flex items-center p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                            <span class="text-3xl mr-4">üö∂‚Äç‚ôÄÔ∏è</span>
                            <div>
                                <p class="font-semibold text-blue-800">10:00 AM - Caminata Ligera</p>
                                <p class="text-sm text-gray-600">20 minutos al aire libre, si el clima lo permite.</p>
                            </div>
                        </div>
                        <div class="flex items-center p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                            <span class="text-3xl mr-4">üíß</span>
                            <div>
                                <p class="font-semibold text-purple-800">Recordatorio: Hidrataci√≥n</p>
                                <p class="text-sm text-gray-600">Beber al menos 2 litros de agua durante el d√≠a.</p>
                            </div>
                        </div>
                        <div class="flex items-center p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-500">
                            <span class="text-3xl mr-4">üìì</span>
                            <div>
                                <p class="font-semibold text-yellow-800">Tarde - Registrar S√≠ntomas</p>
                                <p class="text-sm text-gray-600">Anota c√≥mo te has sentido hoy en tu diario de salud.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="patient-appointments" class="patient-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold">Mis Citas</h3>
                        <button onclick="showRequestAppointmentModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Ôºã Solicitar Nueva Cita</button>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-3">Pr√≥ximas Citas</h4>
                        <div id="upcomingAppointmentsList" class="space-y-4">
                            <div class="p-4 border rounded-lg bg-blue-50">
                                <p class="font-bold text-blue-800">Consulta de Seguimiento</p>
                                <p class="text-gray-700"><strong>Fecha:</strong> 15 de Diciembre, 2024 - 10:00 AM</p>
                                <p class="text-gray-700"><strong>M√©dico:</strong> Dr. Carlos Mart√≠nez</p>
                                <p class="text-gray-700"><strong>Lugar:</strong> Hospital General de Comit√°n, Consultorio 3</p>
                                <div class="mt-3 flex space-x-2">
                                    <button class="bg-blue-500 text-white text-sm px-3 py-1 rounded">Confirmar Asistencia</button>
                                    <button class="bg-yellow-500 text-white text-sm px-3 py-1 rounded">Reprogramar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8">
                        <h4 class="text-lg font-semibold mb-3">Historial de Citas</h4>
                        <ul class="space-y-3">
                            <li class="p-3 bg-gray-100 rounded-lg flex justify-between items-center">
                                <div>
                                    <p class="font-semibold">Sesi√≥n de Quimioterapia</p>
                                    <p class="text-sm text-gray-500">1 de Diciembre, 2024</p>
                                </div>
                                <span class="text-sm text-blue-600 font-medium">‚úîÔ∏è Completada</span>
                            </li>
                            <li class="p-3 bg-gray-100 rounded-lg flex justify-between items-center">
                                <div>
                                    <p class="font-semibold">Consulta de Resultados</p>
                                    <p class="text-sm text-gray-500">15 de Noviembre, 2024</p>
                                </div>
                                <span class="text-sm text-blue-600 font-medium">‚úîÔ∏è Completada</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div id="patient-medications" class="patient-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6">Mi Plan de Medicamentos</h3>
                    <div class="space-y-6">
                        <div class="p-4 border-2 border-blue-500 rounded-lg bg-blue-50">
                            <h4 class="text-xl font-bold text-blue-800 mb-2">üíä Tamoxifeno 20mg</h4>
                            <p class="text-gray-700"><strong>Instrucciones:</strong> Tomar 1 tableta por la ma√±ana con alimentos.</p>
                            <p class="text-gray-700"><strong>Prop√≥sito:</strong> Terapia hormonal para tratar el c√°ncer de mama.</p>
                            <div class="mt-4">
                                <p class="text-sm font-semibold mb-2">Horario de Hoy:</p>
                                <div class="flex items-center justify-between p-3 bg-white rounded-lg">
                                    <span>8:00 AM</span>
                                    <label class="flex items-center space-x-2 cursor-pointer">
                                        <input type="checkbox" class="h-5 w-5 rounded text-blue-600">
                                        <span>Marcar como tomada</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 border rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">üíä Ondansetr√≥n 8mg</h4>
                            <p class="text-gray-600"><strong>Instrucciones:</strong> Tomar 1 tableta 30 minutos antes de la quimioterapia, o si presenta n√°useas.</p>
                            <p class="text-gray-600"><strong>Prop√≥sito:</strong> Prevenir y tratar n√°useas y v√≥mitos.</p>
                        </div>
                        <div class="p-4 border rounded-lg">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">üíä Suplemento de Calcio + Vitamina D</h4>
                            <p class="text-gray-600"><strong>Instrucciones:</strong> Tomar 1 tableta con la cena.</p>
                            <p class="text-gray-600"><strong>Prop√≥sito:</strong> Fortalecer los huesos durante la terapia hormonal.</p>
                        </div>
                    </div>
                    <div class="mt-6 text-center">
                        <button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">üìÑ Descargar Plan de Medicaci√≥n (PDF)</button>
                    </div>
                </div>
            </div>

            <div id="patient-history" class="patient-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6">Mi Historial M√©dico</h3>
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-lg font-bold text-blue-700 border-b pb-2 mb-3">Diagn√≥stico Principal</h4>
                            <p><strong>Condici√≥n:</strong> Carcinoma Ductal Infiltrante (C√°ncer de Mama)</p>
                            <p><strong>Fecha de Diagn√≥stico:</strong> 10 de Octubre, 2024</p>
                            <p><strong>Estadio:</strong> IIA (T2, N0, M0)</p>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-blue-700 border-b pb-2 mb-3">Tratamientos Recibidos</h4>
                            <ul class="list-disc list-inside space-y-1">
                                <li><strong>Cirug√≠a:</strong> Lumpectom√≠a (25 de Octubre, 2024)</li>
                                <li><strong>Quimioterapia:</strong> Esquema AC-T (Inici√≥ 15 de Noviembre, 2024)</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-purple-700 border-b pb-2 mb-3">Resultados de Laboratorio y Estudios</h4>
                            <div class="space-y-3">
                                <div class="p-3 bg-gray-50 rounded-lg flex justify-between items-center">
                                    <p>üìÑ Biopsia - 10/10/2024</p>
                                    <button class="text-sm text-blue-600 hover:underline">Descargar</button>
                                </div>
                                <div class="p-3 bg-gray-50 rounded-lg flex justify-between items-center">
                                    <p>üìÑ An√°lisis de Sangre Pre-Quimio - 14/11/2024</p>
                                    <button class="text-sm text-blue-600 hover:underline">Descargar</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="patient-support" class="patient-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-2">Recursos de Apoyo Emocional</h3>
                    <p class="text-gray-600 mb-8">No est√°s solo/a en este camino. Aqu√≠ tienes recursos para ayudarte.</p>
                    
                    <div class="mb-8">
                        <h4 class="text-xl font-bold mb-4 text-gray-800">Registro de Bienestar Emocional</h4>
                        <div class="p-6 bg-gray-50 rounded-lg border mb-6">
                            <form id="wellness-form" onsubmit="handleWellnessLogSubmit(event)">
                                <p class="font-semibold mb-4 text-gray-700">¬øC√≥mo te sientes hoy?</p>
                                <div class="grid md:grid-cols-3 gap-6 items-center">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">1. Estado de √°nimo (1=Bajo, 5=Excelente)</label>
                                        <div class="flex justify-between">
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="mood" value="1" class="text-blue-600" required><span>1</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="mood" value="2" class="text-blue-600"><span>2</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="mood" value="3" class="text-blue-600"><span>3</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="mood" value="4" class="text-blue-600"><span>4</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="mood" value="5" class="text-blue-600"><span>5</span></label>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">2. Nivel de energ√≠a</label>
                                            <div class="flex justify-between">
                                                <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="energy" value="1" class="text-blue-600" required><span>Bajo</span></label>
                                                <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="energy" value="3" class="text-blue-600"><span>Medio</span></label>
                                                <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="energy" value="5" class="text-blue-600"><span>Alto</span></label>
                                            </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">3. Nivel de ansiedad (1=Nada, 5=Mucha)</label>
                                        <div class="flex justify-between">
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="anxiety" value="1" class="text-blue-600" required><span>1</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="anxiety" value="2" class="text-blue-600"><span>2</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="anxiety" value="3" class="text-blue-600"><span>3</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="anxiety" value="4" class="text-blue-600"><span>4</span></label>
                                            <label class="flex items-center space-x-1 cursor-pointer"><input type="radio" name="anxiety" value="5" class="text-blue-600"><span>5</span></label>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="w-full md:w-auto float-right mt-4 bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700">Guardar Registro</button>
                            </form>
                        </div>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-white rounded-lg border p-4 h-64 flex flex-col">
                                <h5 class="text-center font-semibold text-gray-700 text-sm mb-2">Evoluci√≥n del √Ånimo</h5>
                                <div class="flex-grow"><canvas id="mood-chart"></canvas></div>
                            </div>
                            <div class="bg-white rounded-lg border p-4 h-64 flex flex-col">
                                <h5 class="text-center font-semibold text-gray-700 text-sm mb-2">Resumen de Bienestar</h5>
                                <div class="flex-grow"><canvas id="wellness-summary-chart"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h4 class="text-xl font-bold mb-4 text-gray-800">Progreso del Tratamiento y Bienestar</h4>
                        <div class="bg-white rounded-lg border p-4 h-80">
                               <canvas id="treatment-progress-chart"></canvas>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h4 class="text-xl font-bold mb-4 text-gray-800">Comunicaci√≥n Directa con Especialistas</h4>
                        <div class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-lg border flex flex-col md:flex-row items-start md:items-center justify-between">
                                <div class="mb-3 md:mb-0">
                                    <p class="font-bold text-lg text-purple-800">Dr. Luis Hern√°ndez</p>
                                    <p class="text-sm text-gray-600">Psico-onc√≥logo</p>
                                </div>
                                <div class="flex flex-wrap gap-2">
                                    <button onclick="startChatWithSpecialist('Dr. Luis Hern√°ndez')" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-lg hover:bg-gray-300">üí¨ Chatear</button>
                                    <button onclick="startCallWithSpecialist('Dr. Luis Hern√°ndez')" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-lg hover:bg-gray-300">üìû Llamar</button>
                                    <button onclick="showVideoCallModal('Dr. Luis Hern√°ndez')" class="bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-lg hover:bg-gray-300">üìπ Videollamada</button>
                                    <button onclick="scheduleInPersonAppointment('Dr. Luis Hern√°ndez')" class="bg-purple-600 text-white text-sm px-3 py-1 rounded-lg hover:bg-purple-700">üóìÔ∏è Agendar Presencial</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-8">
                        <h4 class="text-xl font-bold mb-4 text-gray-800">Ejercicios y Recomendaciones para el Bienestar</h4>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="p-6 bg-blue-50 rounded-lg border border-blue-200">
                                <h5 class="font-bold text-lg text-blue-800 mb-3">üå¨Ô∏è Ejercicio de Respiraci√≥n 4-4-6</h5>
                                <p class="text-sm text-gray-600 mb-3">Una t√©cnica simple para calmar la ansiedad en cualquier momento.</p>
                                <ol class="list-decimal list-inside text-sm space-y-1">
                                    <li>Inhala lentamente por la nariz contando hasta 4.</li>
                                    <li>Sost√©n la respiraci√≥n contando hasta 4.</li>
                                    <li>Exhala lentamente por la boca contando hasta 6.</li>
                                    <li>Repite de 5 a 10 veces, concentr√°ndote en el ritmo.</li>
                                </ol>
                            </div>
                            <div class="p-6 bg-blue-50 rounded-lg border border-blue-200">
                                <h5 class="font-bold text-lg text-blue-800 mb-3">üßò‚Äç‚ôÄÔ∏è Ejercicio de 5 Sentidos</h5>
                                <p class="text-sm text-gray-600 mb-3">Conecta con el presente para reducir el estr√©s y los pensamientos abrumadores.</p>
                                <ul class="list-disc list-inside text-sm space-y-1">
                                    <li><strong>Observa</strong> 5 objetos a tu alrededor.</li>
                                    <li><strong>Siente</strong> 4 cosas (ej. la silla, tu ropa).</li>
                                    <li><strong>Escucha</strong> 3 sonidos diferentes.</li>
                                    <li><strong>Huele</strong> 2 aromas distintos.</li>
                                    <li><strong>Saborea</strong> 1 cosa (ej. un sorbo de agua).</li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-6 p-6 bg-gray-50 rounded-lg border">
                            <h5 class="font-bold text-lg text-gray-800 mb-3">‚ú® Recomendaciones Adicionales</h5>
                               <ul class="list-disc list-inside text-sm space-y-2 text-gray-700">
                                    <li><strong>Mant√©n una rutina:</strong> Horarios regulares para dormir y comer pueden darte estabilidad.</li>
                                    <li><strong>Expresa tus emociones:</strong> Habla con tus seres queridos o escribe en un diario.</li>
                                    <li><strong>Actividad suave:</strong> Un paseo corto o estiramientos pueden mejorar tu √°nimo.</li>
                                    <li><strong>S√© amable contigo:</strong> Perm√≠tete descansar y no te exijas demasiado. Cada d√≠a es diferente.</li>
                                </ul>
                        </div>
                    </div>

                    <div class="mb-8">
                           <h4 class="text-xl font-bold mb-4 text-gray-800">Beneficios de Entretenimiento (Descuentos)</h4>
                           <div class="grid md:grid-cols-2 gap-6">
                               <div class="p-6 bg-red-50 rounded-lg border border-red-200 card-hover cursor-pointer" onclick="alert('Se redirigir√° a la p√°gina de convenios Cin√©polis')">
                                   <h5 class="font-bold text-xl text-red-800 mb-3">üé¨ Descuentos en Cin√©polis</h5>
                                   <p class="text-sm text-gray-700 mb-3">Disfruta de la magia del cine a un precio especial.</p>
                                   <ul class="list-disc list-inside text-sm space-y-1 text-red-700">
                                        <li>**50% de descuento** en entradas de Lunes a Viernes.</li>
                                        <li>Precio especial en combos de dulcer√≠a.</li>
                                   </ul>
                                   <button class="mt-4 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 text-sm">Ver C√≥digos y Salas</button>
                               </div>
                               <div class="p-6 bg-purple-50 rounded-lg border border-purple-200 card-hover cursor-pointer" onclick="alert('Se redirigir√° a la cartelera de obras con descuento')">
                                   <h5 class="font-bold text-xl text-purple-800 mb-3">üé≠ Descuentos en Obras de Teatro</h5>
                                   <p class="text-sm text-gray-700 mb-3">Acceso a cultura y esparcimiento con precios preferenciales.</p>
                                   <ul class="list-disc list-inside text-sm space-y-1 text-purple-700">
                                        <li>**30% de descuento** en taquilla para obras seleccionadas.</li>
                                        <li>Beneficio aplica para el paciente y un acompa√±ante.</li>
                                   </ul>
                                   <button class="mt-4 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm">Consultar Cartelera</button>
                               </div>
                           </div>
                       </div>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="p-6 bg-purple-50 rounded-lg border border-purple-200">
                                <h4 class="text-xl font-bold text-purple-800 mb-3">üí¨ Grupos de Apoyo en Comit√°n</h4>
                                <p class="mb-4">Con√©ctate con otras personas que entienden por lo que est√°s pasando.</p>
                                <p><strong>Grupo "Renacer":</strong> Reuniones los martes a las 5:00 PM en el DIF Municipal.</p>
                            </div>
                            <div class="p-6 bg-blue-50 rounded-lg border border-blue-200">
                                <h4 class="text-xl font-bold text-blue-800 mb-3">üìö Art√≠culos y Gu√≠as</h4>
                                <ul class="list-disc list-inside space-y-2">
                                    <li><a href="#" class="text-blue-600 hover:underline">Manejando la ansiedad durante el tratamiento</a></li>
                                    <li><a href="#" class="text-blue-600 hover:underline">C√≥mo hablar con tus seres queridos sobre el c√°ncer</a></li>
                                    <li><a href="#" class="text-blue-600 hover:underline">T√©cnicas de relajaci√≥n y mindfulness para pacientes</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            
            <div id="patient-nutrition" class="patient-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6">Gu√≠a de Nutrici√≥n Oncol√≥gica</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="p-6 bg-yellow-50 rounded-lg">
                            <h4 class="text-lg font-bold mb-3 text-yellow-800">üçΩÔ∏è Plan de Comidas Sugerido</h4>
                            <ul class="text-sm space-y-2">
                                <li><strong>Desayuno:</strong> Avena con frutas y nueces.</li>
                                <li><strong>Almuerzo:</strong> Sopa de lentejas con pollo a la plancha.</li>
                                <li><strong>Cena:</strong> Salm√≥n al horno con br√≥coli y camote.</li>
                                <li><strong>Snacks:</strong> Yogur griego, almendras, batidos de frutas.</li>
                            </ul>
                        </div>
                        <div class="p-6 bg-red-50 rounded-lg">
                            <h4 class="text-lg font-bold mb-3 text-red-800">üö´ Alimentos a Limitar</h4>
                            <ul class="text-sm list-disc list-inside space-y-1">
                                <li>Alimentos procesados y ultraprocesados.</li>
                                <li>Carnes rojas en exceso.</li>
                                <li>Az√∫cares refinados y bebidas azucaradas.</li>
                                <li>Alcohol.</li>
                            </ul>
                        </div>
                        <div class="p-6 bg-blue-50 rounded-lg">
                            <h4 class="text-lg font-bold mb-3 text-blue-800">üí° Consejos Clave</h4>
                            <ul class="text-sm list-disc list-inside space-y-1">
                                <li>Mantente bien hidratado/a.</li>
                                <li>Come porciones peque√±as y frecuentes si no tienes apetito.</li>
                                <li>Enf√≥cate en alimentos ricos en prote√≠nas para la recuperaci√≥n.</li>
                                <li>Consulta siempre antes de tomar suplementos.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="mt-8 text-center border-t pt-6">
                        <button onclick="window.location.href='comida.html';" class="bg-gradient-to-r from-blue-500 to-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 mb-4">
                            Jarelux Nutrimental
                        </button>
                        <p class="mb-3">Para un plan personalizado, contacta a un especialista.</p>
                        <p><strong>Nutri√≥loga Oncol√≥gica:</strong> Lic. Mar√≠a Flores - üìû (963) 632-7777</p>
                    </div>
                </div>
            </div>

            <div id="patient-services" class="patient-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6">Servicios Locales en Comit√°n de Dom√≠nguez</h3>
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <h4 class="font-bold text-lg mb-3 text-red-600">üè• Hospitales</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>Hospital General de Comit√°n:</strong> <br>Av. Central Norte #15 - üìû (963) 632-0150</p>
                                <p><strong>IMSS Comit√°n:</strong> <br>Blvd. Dr. Belisario Dom√≠nguez - üìû (963) 632-1234</p>
                            </div>
                        </div>
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <h4 class="font-bold text-lg mb-3 text-blue-600">üî¨ Laboratorios</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>Laboratorios Salud Digna:</strong> <br>Calle Central Poniente #10</p>
                                <p><strong>Laboratorio Cl√≠nico de Comit√°n:</strong> <br>2a Av. Poniente Sur #5</p>
                            </div>
                        </div>
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <h4 class="font-bold text-lg mb-3 text-blue-600">üíä Farmacias 24h</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>Farmacia Guadalajara:</strong> <br>Av. Central Sur #23</p>
                                <p><strong>Farmacia del Ahorro:</strong> <br>Blvd. Belisario Dom√≠nguez</p>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 text-center border-t pt-6">
                        <button onclick="window.location.href='descuento.html';" class="bg-gradient-to-r from-blue-500 to-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 mb-4">
                            jarelux descuentos
                        </button>

                        <button onclick="window.location.href='tr.html';" class="bg-gradient-to-r from-blue-500 to-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 mb-4">
                            jareluex trasporte
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="requestAppointmentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
        <div id="appointmentModalContent" class="bg-white rounded-lg shadow-xl p-8 w-full max-w-lg transition-transform duration-300 transform scale-95">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Solicitar Nueva Cita</h3>
                <button onclick="hideRequestAppointmentModal()" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <form id="appointmentRequestForm" onsubmit="handleAppointmentRequest(event)">
                <div class="space-y-4">
                    <div>
                        <label for="appointmentType" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Cita</label>
                        <select id="appointmentType" name="appointmentType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Seleccione una opci√≥n</option>
                            <option value="Consulta de Seguimiento">Consulta de Seguimiento</option>
                            <option value="Revisi√≥n de Resultados">Revisi√≥n de Resultados</option>
                            <option value="Consulta por nuevos s√≠ntomas">Consulta por nuevos s√≠ntomas</option>
                            <option value="Otro motivo">Otro motivo</option>
                        </select>
                    </div>
                    <div>
                        <label for="preferredDate" class="block text-sm font-medium text-gray-700 mb-1">Fecha Preferida</label>
                        <input type="date" id="preferredDate" name="preferredDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    <div>
                        <label for="appointmentNotes" class="block text-sm font-medium text-gray-700 mb-1">Motivo o Notas (Opcional)</label>
                        <textarea id="appointmentNotes" name="appointmentNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ej: He sentido m√°s cansancio de lo normal..."></textarea>
                    </div>
                </div>
                <div class="mt-8 flex justify-end space-x-3">
                    <button type="button" onclick="hideRequestAppointmentModal()" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300">Cancelar</button>
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Enviar Solicitud</button>
                </div>
            </form>
        </div>
    </div>
    <button onclick="showLuxiChat()" id="luxi-fab" class="fixed bottom-6 right-6 bg-purple-600 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center transform hover:scale-110 transition-transform z-40">
        <span class="text-3xl">ü§ñ</span>
    </button>

    <div id="luxi-chat-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50 modal-backdrop">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col h-[70vh] modal-content transform scale-95">
            <div class="bg-purple-600 text-white p-4 rounded-t-lg flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">ü§ñ</span>
                    <h3 class="text-xl font-bold">Asistente Virtual Luxi</h3>
                </div>
                <button onclick="hideLuxiChat()" class="text-purple-100 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="luxi-messages" class="flex-1 p-4 overflow-y-auto bg-gray-100 space-y-4">
            </div>
            <div class="p-4 border-t bg-white rounded-b-lg">
                <div class="flex space-x-2">
                    <input type="text" id="luxi-input" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Escribe tu pregunta..." onkeypress="handleLuxiKeyPress(event)">
                    <button onclick="sendLuxiMessage()" class="bg-purple-600 text-white px-4 rounded-lg hover:bg-purple-700 shrink-0">Enviar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="video-call-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 hidden z-50 modal-backdrop">
        <div class="bg-gray-800 text-white rounded-lg shadow-2xl w-full max-w-3xl flex flex-col modal-content transform scale-95 relative">
            <div class="bg-gray-900 p-4 rounded-t-lg flex justify-between items-center">
                <div>
                    <h3 class="text-xl font-bold" id="video-call-specialist-name">Videollamada con Dr. ...</h3>
                    <p class="text-sm text-gray-400">Estado: <span class="text-green-400">Conectado</span> ‚Ä¢ <span id="video-call-timer">00:00</span></p>
                </div>
                <button onclick="hideVideoCallModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="flex-1 bg-black relative flex items-center justify-center">
                <div class="text-center">
                    <div class="w-32 h-32 bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-gray-600">
                        <span class="text-6xl">üë®‚Äç‚öïÔ∏è</span>
                    </div>
                    <h4 class="text-2xl" id="video-call-specialist-name-main">Dr. Luis Hern√°ndez</h4>
                    <p class="text-gray-400">Psico-onc√≥logo</p>
                </div>
                <div class="absolute bottom-4 right-4 w-48 h-36 bg-gray-700 rounded-lg border-2 border-gray-500 flex items-center justify-center text-center">
                    <div>
                        <div class="w-12 h-12 bg-gray-600 rounded-full flex items-center justify-center mx-auto mb-2">
                            <span class="text-2xl">üòä</span>
                        </div>
                        <p class="text-sm font-semibold">T√∫</p>
                    </div>
                </div>
            </div>

            <div class="bg-gray-900 p-4 rounded-b-lg flex justify-center items-center space-x-4">
                <button id="mic-btn" onclick="toggleMic()" class="bg-gray-600 hover:bg-gray-500 w-14 h-14 rounded-full flex items-center justify-center text-2xl">üé§</button>
                <button id="cam-btn" onclick="toggleCam()" class="bg-gray-600 hover:bg-gray-500 w-14 h-14 rounded-full flex items-center justify-center text-2xl">üìπ</button>
                <button onclick="toggleVideoChat()" class="bg-blue-600 hover:bg-blue-500 w-14 h-14 rounded-full flex items-center justify-center text-2xl">üí¨</button>
                <button onclick="hideVideoCallModal()" class="bg-red-600 hover:bg-red-700 w-20 h-14 rounded-full flex items-center justify-center text-2xl">üìû</button>
            </div>
            
            <div id="video-chat-panel" class="absolute right-0 top-0 h-full w-80 bg-white text-black flex-col hidden transform translate-x-full transition-transform duration-300">
                <div class="p-3 border-b flex justify-between items-center bg-gray-50">
                    <h4 class="font-bold">Chat de la consulta</h4>
                    <button onclick="toggleVideoChat()" class="text-gray-500 hover:text-gray-800 text-xl">&times;</button>
                </div>
                <div id="video-chat-messages" class="flex-1 p-3 overflow-y-auto bg-gray-100 space-y-3"></div>
                <div class="p-2 border-t">
                    <div class="flex space-x-2">
                        <input type="text" id="video-chat-input" class="w-full px-3 py-2 border rounded-lg text-sm" placeholder="Escribe un mensaje...">
                        <button onclick="sendVideoChatMessage()" class="bg-purple-600 text-white px-3 rounded-lg text-sm">Enviar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUserType = '';
        let currentUser = '';

        // Login functions
        function showLogin(userType) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            currentUserType = userType;
            
            const titles = {
                'patient': 'Acceso Paciente'
            };
            
            document.getElementById('loginTitle').textContent = titles[userType];
        }

        function backToSelection() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                currentUser = username;
                document.getElementById('userName').textContent = `Bienvenido, ${username}`;
                document.getElementById('userInfo').classList.remove('hidden');
                
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('loginScreen').classList.add('hidden');
                
                if (currentUserType === 'patient') {
                    document.getElementById('patientDashboard').classList.remove('hidden');
                    // Asegurar que el bot√≥n "Inicio" se marque como activo al iniciar sesi√≥n
                    document.querySelector('.patient-nav-btn').classList.remove('bg-gray-200', 'text-gray-700');
                    document.querySelector('.patient-nav-btn').classList.add('bg-blue-600', 'text-white');
                }
            }
        }

        function logout() {
            document.getElementById('patientDashboard').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            currentUser = '';
            currentUserType = '';
        }
        
        // Patient dashboard functions
        function showPatientSection(section, event) {
            document.querySelectorAll('.patient-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`patient-${section}`).classList.remove('hidden');
            
            document.querySelectorAll('.patient-nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            // La l√≥gica para marcar el bot√≥n activo si la llamada viene de un click (event)
            if (event && event.target) {
                event.target.classList.remove('bg-gray-200', 'text-gray-700');
                event.target.classList.add('bg-blue-600', 'text-white');
            } else {
                 // Fallback para marcar el bot√≥n si se llama program√°ticamente (ej. despu√©s de login)
                 const targetBtn = document.querySelector(`[onclick="showPatientSection('${section}', event)"]`);
                 if(targetBtn) {
                    targetBtn.classList.remove('bg-gray-200', 'text-gray-700');
                    targetBtn.classList.add('bg-blue-600', 'text-white');
                 }
            }


            if (section === 'support') {
                initializeSupportCharts();
            }
        }

        // Citas Modal Functions - CORREGIDAS
        const appointmentModal = document.getElementById('requestAppointmentModal');
        // Se apunta al nuevo ID en el div interno
        const appointmentModalContent = document.getElementById('appointmentModalContent');

        function showRequestAppointmentModal() {
            // 1. Oculta el scroll del cuerpo
            document.body.style.overflow = 'hidden';

            appointmentModal.classList.remove('hidden');
            // Forzar el redibujado para que las transiciones funcionen
            void appointmentModal.offsetWidth;

            // 2. Aplicar las clases finales para la transici√≥n de entrada
            appointmentModal.classList.add('opacity-100');
            appointmentModalContent.classList.remove('scale-95');
            appointmentModalContent.classList.add('scale-100');

            // **IMPORTANTE:** No se a√±aden listeners para 'Esc' o 'clic fuera',
            // lo que bloquea el cierre involuntario como se solicit√≥.
        }

        function hideRequestAppointmentModal() {
            // 1. Iniciar transici√≥n de salida
            appointmentModal.classList.remove('opacity-100');
            appointmentModalContent.classList.remove('scale-100');
            appointmentModalContent.classList.add('scale-95');

            // 2. Restaurar el scroll del cuerpo
            document.body.style.overflow = ''; 

            // 3. Ocultar modal despu√©s de la transici√≥n
            setTimeout(() => {
                appointmentModal.classList.add('hidden');
                document.getElementById('appointmentRequestForm').reset();
            }, 300);
        }
        
        function handleAppointmentRequest(event) {
            event.preventDefault();
            const type = document.getElementById('appointmentType').value;
            const date = document.getElementById('preferredDate').value;
            const notes = document.getElementById('appointmentNotes').value;
            const formattedDate = new Date(date + 'T00:00:00').toLocaleDateString('es-ES', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
            addAppointmentToList(type, formattedDate, notes);
            hideRequestAppointmentModal();
            alert('‚úÖ Tu solicitud de cita ha sido enviada.\nRecibir√°s una notificaci√≥n cuando sea confirmada.');
        }

        function addAppointmentToList(type, date, notes) {
            const list = document.getElementById('upcomingAppointmentsList');
            const newAppointmentHTML = `
                <div class="p-4 border rounded-lg bg-yellow-50 border-yellow-300">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold text-yellow-800">${type}</p>
                            <p class="text-gray-700"><strong>Fecha solicitada:</strong> ${date}</p>
                            <p class="text-gray-700"><strong>M√©dico:</strong> Por asignar</p>
                            ${notes ? `<p class="text-sm text-gray-600 mt-2"><strong>Motivo:</strong> ${notes}</p>` : ''}
                        </div>
                        <span class="bg-yellow-200 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">Pendiente de Confirmaci√≥n</span>
                    </div>
                </div>
            `;
            list.insertAdjacentHTML('afterbegin', newAppointmentHTML);
        }

        

        // Se dejan estas funciones vac√≠as para forzar que el modal SOLO se cierre con hideRequestAppointmentModal()
        function closeIfEscPressed(event) { }
        function closeIfClickedOutside(event) { }


        // Asistente Virtual Luxi Functions (Ahora con respuestas definidas - sin API)
        const luxiModal = document.getElementById('luxi-chat-modal');
        const luxiModalContent = luxiModal.querySelector('.modal-content');
        const luxiMessagesContainer = document.getElementById('luxi-messages');

        function showLuxiChat() {
            document.body.style.overflow = 'hidden';
            luxiModal.classList.remove('hidden');
            setTimeout(() => {
                luxiModal.style.opacity = 1;
                luxiModalContent.style.transform = 'scale(1)';
            }, 10);
            if (luxiMessagesContainer.children.length === 0) {
                 // Usa addMessageToLuxiChat para el mensaje de bienvenida
                addMessageToLuxiChat("¬°Hola! Soy Luxi, tu asistente virtual de Jarelux. Estoy aqu√≠ para resolver dudas r√°pidas sobre el portal. ¬øNecesitas informaci√≥n sobre tus **Citas**, **Medicamentos**, **Apoyo** o **Servicios**?", 'luxi');
            }
        }

        function hideLuxiChat() {
            document.body.style.overflow = ''; 
            luxiModal.style.opacity = 0;
            luxiModalContent.style.transform = 'scale(0.95)';
            setTimeout(() => {
                luxiModal.classList.add('hidden');
            }, 300);
        }

        function handleLuxiKeyPress(event) {
            if (event.key === 'Enter') {
                sendLuxiMessage();
            }
        }

        // üîë INICIO C√ìDIGO CHATBOT LOCAL (MEJORADO) üîë
        async function sendLuxiMessage() {
            const input = document.getElementById('luxi-input');
            const userQuery = input.value.trim().toLowerCase();
            if (!userQuery) return;

            addMessageToLuxiChat(input.value.trim(), 'user');
            input.value = '';
            addLuxiThinkingMessage();

            // L√≥gica de respuestas definidas
            let luxiResponse = "Lo siento, no tengo una respuesta predefinida para esa pregunta. Por favor, consulta las secciones del portal (como 'Citas', 'Medicamentos' o 'Apoyo') o contacta a tu especialista para informaci√≥n espec√≠fica.";

            // --- RESPUESTAS POR CATEGOR√çA ---

            // 1. SALUDO / INICIO
            if (userQuery.includes("hola") || userQuery.includes("saludo") || userQuery.includes("que tal") || userQuery.includes("gracias")) {
                if(userQuery.includes("gracias")) {
                    luxiResponse = "De nada, es un gusto ayudarte. Si tienes m√°s preguntas, solo escr√≠beme. ¬°Te deseo un excelente d√≠a!";
                } else {
                    luxiResponse = "¬°Hola! Soy Luxi, tu asistente virtual de Jarelux. Estoy aqu√≠ para resolver dudas r√°pidas sobre el portal. ¬øNecesitas informaci√≥n sobre **Citas**, **Medicamentos**, **Apoyo** o tienes alguna pregunta general?";
                }
            } 
            
            // 2. DETECCI√ìN DE EMERGENCIAS (Regla Cr√≠tica)
            else if (userQuery.includes("dolor fuerte en el pecho") || userQuery.includes("dificultad para respirar") || userQuery.includes("sangrado incontrolable") || userQuery.includes("autolesi√≥n") || userQuery.includes("emergencia")) {
                luxiResponse = "üö® **Detecto una posible emergencia. Por favor, no esperes. Llama al 911 de inmediato o acude al servicio de urgencias m√°s cercano. Tu seguridad es lo m√°s importante.**";
            }

            // 3. PREGUNTAS SOBRE EL PORTAL
            else if (userQuery.includes("citas") || userQuery.includes("agendar") || userQuery.includes("proxima cita")) {
                luxiResponse = "Puedes ver tus **pr√≥ximas citas** y solicitar una nueva desde la secci√≥n **üìÖ Citas** en el men√∫ principal. Si necesitas reprogramar, haz clic en el bot√≥n 'Reprogramar' de tu cita pendiente.";
            } 
            else if (userQuery.includes("medicamentos") || userQuery.includes("dosis") || userQuery.includes("olvidar dosis")) {
                if (userQuery.includes("olvidar dosis")) {
                     luxiResponse = "Si olvidaste una dosis, **no tomes una dosis doble**. Llama a tu onc√≥logo o a tu farmac√©utico de inmediato para obtener instrucciones precisas. Consulta tu plan completo en la secci√≥n **üíä Medicamentos**.";
                } else {
                    luxiResponse = "Tu plan de medicamentos detallado (incluyendo dosis y horarios) se encuentra en la secci√≥n **üíä Medicamentos**. Es crucial que sigas las instrucciones de tu onc√≥logo al pie de la letra.";
                }
            } 
            else if (userQuery.includes("apoyo") || userQuery.includes("emocional") || userQuery.includes("ansiedad")) {
                luxiResponse = "La secci√≥n **‚ù§Ô∏è Apoyo** tiene recursos valiosos: t√©cnicas de relajaci√≥n (como el ejercicio 4-4-6), grupos de apoyo en Comit√°n y la opci√≥n de contactar directamente a tu psico-onc√≥logo, Dr. Luis Hern√°ndez. Recuerda registrar tu bienestar emocional diariamente.";
            } 
            else if (userQuery.includes("historial") || userQuery.includes("documentos")) {
                luxiResponse = "Tus documentos m√°s importantes (Biopsias, An√°lisis, Diagn√≥stico) se encuentran en la secci√≥n **üìÇ Historial**. Puedes descargarlos en formato PDF para revisarlos o compartirlos con otros m√©dicos, si es necesario.";
            }
            else if (userQuery.includes("servicios") || userQuery.includes("hospital") || userQuery.includes("farmacia")) {
                luxiResponse = "La secci√≥n **üìç Servicios** te proporciona informaci√≥n de contacto y ubicaciones de hospitales (como el Hospital General de Comit√°n), laboratorios y farmacias 24h en la zona. Tambi√©n encontrar√°s enlaces para descuentos y transporte.";
            }
            
            // 4. PREGUNTAS GENERALES DE SALUD (No espec√≠ficas del paciente)
            else if (userQuery.includes("nauseas") || userQuery.includes("vomito") || userQuery.includes("que comer si tengo nauseas")) {
                luxiResponse = "Las **n√°useas** son un efecto secundario com√∫n. Intenta comer alimentos blandos (como tostadas, arroz, caldo), evita los alimentos muy grasosos o picantes, y bebe l√≠quidos fr√≠os lentamente. **Importante:** Si las n√°useas son severas, consulta a tu m√©dico; podr√≠an recetarte un medicamento antiem√©tico m√°s fuerte.";
            }
            else if (userQuery.includes("fatiga") || userQuery.includes("cansancio")) {
                luxiResponse = "La **fatiga oncol√≥gica** es real. Trata de balancear el descanso con actividad ligera (como una caminata corta). Duerme bien, prioriza las tareas y pide ayuda. Recuerda registrar tu nivel de energ√≠a en la secci√≥n **‚ù§Ô∏è Apoyo** para que tu m√©dico pueda monitorearlo.";
            }
            else if (userQuery.includes("quimioterapia") || userQuery.includes("radioterapia")) {
                luxiResponse = "Son tratamientos comunes contra el c√°ncer. La **quimioterapia** usa f√°rmacos para destruir las c√©lulas cancerosas en todo el cuerpo, y la **radioterapia** usa radiaci√≥n para da√±ar las c√©lulas cancerosas en un √°rea espec√≠fica. Ambos pueden tener efectos secundarios que tu equipo m√©dico puede manejar.";
            }
            
            // 5. REDIRECCI√ìN A ESPECIALISTAS (Regla Cr√≠tica)
            else if (userQuery.includes("pronostico") || userQuery.includes("etapa") || userQuery.includes("resultados") || userQuery.includes("diagnostico") || userQuery.includes("esquema de tratamiento")) {
                luxiResponse = "Esa es una pregunta muy importante que debe ser respondida por tu **equipo m√©dico u onc√≥logo**, ya que ellos conocen tu caso a fondo. Por favor, cons√∫ltalo con ellos para recibir una interpretaci√≥n precisa de tu historial y resultados.";
            }

            // Simular el tiempo de respuesta
            await new Promise(resolve => setTimeout(resolve, 800));

            removeLuxiThinkingMessage();
            addMessageToLuxiChat(luxiResponse, 'luxi');
        }
        // üîë FIN C√ìDIGO CHATBOT LOCAL (MEJORADO) üîë
        
        function addLuxiThinkingMessage() {
            const messageElement = document.createElement('div');
            messageElement.className = 'flex justify-start';
            messageElement.id = 'luxi-thinking';
            messageElement.innerHTML = `
                <div class="bg-white text-gray-800 p-3 rounded-lg max-w-xs border">
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            `;
            luxiMessagesContainer.appendChild(messageElement);
            luxiMessagesContainer.scrollTop = luxiMessagesContainer.scrollHeight;
        }

        function removeLuxiThinkingMessage() {
            const thinkingMessage = document.getElementById('luxi-thinking');
            if (thinkingMessage) {
                thinkingMessage.remove();
            }
        }


        function addMessageToLuxiChat(message, sender) {
            const messageElement = document.createElement('div');
            if (sender === 'user') {
                messageElement.className = 'flex justify-end';
                messageElement.innerHTML = `<div class="bg-blue-600 text-white p-3 rounded-lg max-w-xs">${message}</div>`;
            } else {
                messageElement.className = 'flex justify-start';
                // A√±adimos un peque√±o identificador para Luxi
                const luxiContent = `<div class="font-semibold text-purple-700 mb-1">Luxi:</div>${message}`;
                messageElement.innerHTML = `<div class="bg-white text-gray-800 p-3 rounded-lg max-w-xs border">${luxiContent}</div>`;
            }
            luxiMessagesContainer.appendChild(messageElement);
            luxiMessagesContainer.scrollTop = luxiMessagesContainer.scrollHeight;
        }

        // Funciones para la secci√≥n de apoyo emocional
        function startChatWithSpecialist(specialistName) {
            alert(`üí¨ Iniciando chat con ${specialistName}...\n\nEn una aplicaci√≥n real, esto abrir√≠a una ventana de chat segura para hablar con el especialista.`);
        }

        function startCallWithSpecialist(specialistName) {
            alert(`üìû Realizando llamada a ${specialistName}...\n\nEn una aplicaci√≥n real, esto iniciar√≠a una llamada de voz segura.`);
        }

        function scheduleInPersonAppointment(specialistName) {
            alert(`üóìÔ∏è Agendando cita presencial con ${specialistName}...\n\nEn una aplicaci√≥n real, esto te llevar√≠a a un calendario para seleccionar una fecha y hora disponibles para una consulta en persona.`);
        }

        // Funciones para la videollamada
        const videoCallModal = document.getElementById('video-call-modal');
        const videoCallModalContent = videoCallModal.querySelector('.modal-content');
        let callInterval;
        let seconds = 0;

        function showVideoCallModal(specialistName) {
            document.getElementById('video-call-specialist-name').textContent = `Videollamada con ${specialistName}`;
            document.getElementById('video-call-specialist-name-main').textContent = specialistName;
            
            videoCallModal.classList.remove('hidden');
            setTimeout(() => {
                videoCallModal.style.opacity = 1;
                videoCallModalContent.style.transform = 'scale(1)';
            }, 10);
            
            startTimer();
        }

        function hideVideoCallModal() {
            videoCallModal.style.opacity = 0;
            videoCallModalContent.style.transform = 'scale(0.95)';
            setTimeout(() => {
                videoCallModal.classList.add('hidden');
            }, 300);
            stopTimer();
            document.getElementById('video-chat-panel').classList.add('hidden', 'translate-x-full');
        }

        function startTimer() {
            seconds = 0;
            const timerEl = document.getElementById('video-call-timer');
            timerEl.textContent = '00:00';
            callInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                timerEl.textContent = `${mins}:${secs}`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(callInterval);
        }

        function toggleMic() {
            const micBtn = document.getElementById('mic-btn');
            const isMuted = micBtn.classList.toggle('bg-red-600');
            micBtn.innerHTML = isMuted ? 'üîá' : 'üé§';
        }

        function toggleCam() {
            const camBtn = document.getElementById('cam-btn');
            const isOff = camBtn.classList.toggle('bg-red-600');
            camBtn.innerHTML = isOff ? 'üì∑' : 'üìπ';
        }

        function toggleVideoChat() {
            // Alternar la clase 'hidden' y la transformaci√≥n para deslizar
            const chatPanel = document.getElementById('video-chat-panel');
            const isHidden = chatPanel.classList.contains('hidden');

            if (isHidden) {
                chatPanel.classList.remove('hidden');
                setTimeout(() => {
                    chatPanel.classList.remove('translate-x-full');
                }, 10); // Un peque√±o retraso para que la transici√≥n sea visible
            } else {
                chatPanel.classList.add('translate-x-full');
                setTimeout(() => {
                    chatPanel.classList.add('hidden');
                }, 300); // 300ms es la duraci√≥n de la transici√≥n
            }
        }

        function sendVideoChatMessage() {
            const input = document.getElementById('video-chat-input');
            const message = input.value.trim();
            if (!message) return;

            addVideoChatMessage(message, 'user');
            input.value = '';

            setTimeout(() => {
                addVideoChatMessage("Entiendo. Gracias por compartirlo conmigo. Continuemos hablando.", 'specialist');
            }, 1500);
        }

        function addVideoChatMessage(message, sender) {
            const container = document.getElementById('video-chat-messages');
            const messageEl = document.createElement('div');
            if (sender === 'user') {
                messageEl.className = 'flex justify-end';
                messageEl.innerHTML = `<div class="bg-blue-500 text-white p-2 rounded-lg max-w-xs text-sm">${message}</div>`;
            } else {
                messageEl.className = 'flex justify-start';
                messageEl.innerHTML = `<div class="bg-gray-200 text-gray-800 p-2 rounded-lg max-w-xs text-sm">${message}</div>`;
            }
            container.appendChild(messageEl);
            container.scrollTop = container.scrollHeight;
        }

        // Funciones para gr√°ficos de bienestar
        let moodChart, wellnessSummaryChart, treatmentProgressChart;

        function initializeSupportCharts() {
            if (moodChart) moodChart.destroy();
            if (wellnessSummaryChart) wellnessSummaryChart.destroy();
            if (treatmentProgressChart) treatmentProgressChart.destroy();

            // Mood Chart (Line)
            const moodCtx = document.getElementById('mood-chart').getContext('2d');
            moodChart = new Chart(moodCtx, {
                type: 'line',
                data: {
                    labels: ['Hace 6 d√≠as', 'Hace 5 d√≠as', 'Hace 4 d√≠as', 'Hace 3 d√≠as', 'Ayer'],
                    datasets: [{
                        label: 'Estado de √Ånimo',
                        data: [3, 4, 3, 5, 4],
                        borderColor: 'rgba(59, 130, 246, 0.8)',
                        backgroundColor: 'transparent',
                        pointBackgroundColor: 'rgba(59, 130, 246, 1)',
                        pointRadius: 4,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 5 } }, plugins: { legend: { display: false } } }
            });

            // Wellness Summary (Radar)
            const wellnessCtx = document.getElementById('wellness-summary-chart').getContext('2d');
            wellnessSummaryChart = new Chart(wellnessCtx, {
                type: 'radar',
                data: {
                    labels: ['√Ånimo', 'Energ√≠a', 'Ansiedad (Inverso)'],
                    datasets: [{
                        label: '√öltimo Registro',
                        data: [4, 3, 2], // Ansiedad se invierte (5-ansiedad) para que m√°s alto sea mejor
                        backgroundColor: 'rgba(168, 85, 247, 0.2)',
                        borderColor: 'rgba(168, 85, 247, 1)',
                        borderWidth: 2
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { beginAtZero: true, max: 5, stepSize: 1, pointLabels: { font: { size: 11 } } } }, plugins: { legend: { display: false } } }
            });

            const progressCtx = document.getElementById('treatment-progress-chart').getContext('2d');
            treatmentProgressChart = new Chart(progressCtx, {
                type: 'bar',
                data: {
                    labels: ['Inicio Tto.', 'Ciclo 2', 'Ciclo 3', 'Ciclo 4 (Actual)'],
                    datasets: [
                        {
                            type: 'line',
                            label: 'Estado de √Ånimo (1-5)',
                            data: [3, 4, 2, 4],
                            borderColor: 'rgba(239, 68, 68, 0.8)',
                            backgroundColor: 'transparent',
                            yAxisID: 'y1',
                            tension: 0.3,
                            pointRadius: 5,
                            pointBackgroundColor: 'rgba(239, 68, 68, 1)'
                        },
                        {
                            type: 'bar',
                            label: 'Progreso del Tratamiento (%)',
                            data: [25, 50, 75, 85],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Progreso (%)' }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            beginAtZero: true,
                            max: 5,
                            grid: { drawOnChartArea: false },
                            title: { display: true, text: '√Ånimo (1-5)' }
                        }
                    }
                }
            });
        }

        function handleWellnessLogSubmit(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const mood = parseInt(formData.get('mood'));
            const energy = parseInt(formData.get('energy'));
            const anxiety = parseInt(formData.get('anxiety'));

            // Actualizar Gr√°fico de √Ånimo
            moodChart.data.labels.push('Hoy');
            moodChart.data.datasets[0].data.push(mood);
            if(moodChart.data.labels.length > 7) {
                moodChart.data.labels.shift();
                moodChart.data.datasets[0].data.shift();
            }
            moodChart.update();
            
            // Actualizar Gr√°fico de Resumen (Radar)
            // La ansiedad se calcula como 5 - valor para que un valor alto sea mejor
            wellnessSummaryChart.data.datasets[0].data = [mood, energy, 6 - anxiety]; 
            wellnessSummaryChart.update();

            alert('‚úÖ Tu registro de bienestar ha sido guardado. ¬°Gracias por compartir c√≥mo te sientes!');
            event.target.reset();
        }
    </script>
</body>
<footer class="bg-gray-800 text-white py-12">
    <div class="container mx-auto px-6">
        <div class="grid md:grid-cols-4 gap-8">
            <div>
                <div class="flex items-center space-x-3 mb-4">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold">J</span>
                    </div>
                    <h4 class="text-xl font-bold">Jarelux</h4>
                </div>
                <p class="text-gray-400">Conectando pacientes con c√°ncer con descuentos que marcan la diferencia en su tratamiento.</p>
            </div>
            <div>
                <h5 class="font-semibold mb-4">Servicios</h5>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-white transition-colors">Farmacias</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Cl√≠nicas</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Hospitales</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Laboratorios</a></li>
                </ul>
            </div>
            <div>
                <h5 class="font-semibold mb-4">Soporte</h5>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-white transition-colors">Centro de Ayuda</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Preguntas Frecuentes</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Contacto</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">T√©rminos y Condiciones</a></li>
                </ul>
            </div>
            <div>
                <h5 class="font-semibold mb-4">Contacto</h5>
                <div class="space-y-2 text-gray-400">
                        <p>üìû 963-121-9655</p>
                        <p>‚úâÔ∏è jarelux.25.contacto@gmail.com</p>
                        <p>üìç Comit√°n de Dom√≠nguez, Chiapas</p>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
            <p>&copy; 2025 Jarelux. Todos los derechos reservados.</p>
        </div>
    </div>
</footer>
