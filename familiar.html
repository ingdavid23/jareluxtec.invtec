<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jarelux - Portal Familiar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e40af 0%, #1e40af 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        #map {
            height: 100%;
            min-height: 500px; 
            z-index: 1;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }
        .leaflet-popup-content {
            margin: 10px;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12  flex items-center justify-center p-1">
                        <img src="1000217146 (1).png" alt="Logo de Jarelux" class="w-full h-full object-contain">
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold">Jarelux</h1>
                        <p class="text-blue-100">Portal de Apoyo Familiar</p>
                    </div>
                </div>
                <div id="userInfo" class="hidden">
                    <span id="userName" class="mr-4"></span>
                    <button onclick="logout()" class="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50">
                        Cerrar Sesi√≥n
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="max-w-md w-full">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Bienvenido a Jarelux</h2>
                <p class="text-xl text-gray-600">Acceso para Familiares</p>
            </div>
            
            <div class="grid grid-cols-1 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-8 card-hover cursor-pointer" onclick="showLogin('family')">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6">
                            <span class="text-4xl">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Familiar</h3>
                        <p class="text-gray-600 mb-6">Acompa√±a el tratamiento de tu ser querido</p>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-sm text-blue-700">‚Ä¢ Emergencias</p>
                            <p class="text-sm text-blue-700">‚Ä¢ Estado del paciente</p>
                            <p class="text-sm text-blue-700">‚Ä¢ Comunicaci√≥n m√©dica</p>
                        </div>
                    </div>
                </div>
            </div>
            <BR>  
                <div class="flex justify-center">
                    <button onclick="window.location.href='index.html';" class="bg-gradient-to-r from-blue-500 to-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 mb-4">
                        volver  
                    </button>
                </div>
            </BR>
        </div>
    </div>

    <div id="loginForm" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-lg p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <h3 id="loginTitle" class="text-2xl font-bold text-gray-800 mb-2"></h3>
                <p class="text-gray-600">Ingresa tus credenciales</p>
            </div>
            
            <form onsubmit="handleLogin(event)">
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Usuario</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ingresa tu usuario" required>
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Contrase√±a</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ingresa tu contrase√±a" required>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-300">
                    Iniciar Sesi√≥n
                </button>
            </form>
            
            <button onclick="backToSelection()" class="w-full mt-4 text-gray-600 hover:text-gray-800">
                ‚Üê Volver
            </button>
        </div>
    </div>

    <div id="familyDashboard" class="hidden">
        <div class="container mx-auto px-4 py-8">
            <nav class="bg-white rounded-lg shadow-md mb-8">
                <div class="flex flex-wrap justify-center space-x-1 p-2">
                    <button onclick="showFamilySection('overview')" class="family-nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg m-1">üè†Inicio</button>
                    <button onclick="showFamilySection('emergency')" class="family-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üö®Emergencias</button>
                    <button onclick="showFamilySection('status')" class="family-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">ü©∫Estado</button>
                    <button onclick="showFamilySection('communication')" class="family-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üìûComunicaci√≥n</button>
                    <button onclick="showFamilySection('calendar')" class="family-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üìÜCalendario</button>
                    <button onclick="showFamilySection('directory')" class="family-nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg m-1">üììDirectorio</button>
                </div>
            </nav>

            <div id="family-overview" class="family-section">
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">

                    <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-1">
                        <h4 class="font-bold text-lg mb-4">Estado del Paciente</h4>
                        <div class="flex items-center mb-4">
                            <span class="w-4 h-4 bg-green-500 rounded-full mr-3 animate-pulse"></span>
                            <span class="text-green-600 font-semibold text-xl">Estable</span>
                        </div>
                        <p class="text-gray-800 text-lg mb-2">Mar√≠a Gonz√°lez</p>
                        <p class="text-sm text-gray-500">√öltima actualizaci√≥n del m√©dico: Hoy 2:30 PM</p>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold text-lg">Signos Vitales</h4>
                            <p class="text-sm text-gray-500">Actualizaci√≥n: Hoy 10:45 AM</p>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-3xl">‚ù§Ô∏è</p>
                                <p class="text-gray-600 text-sm mt-1">Ritmo Card√≠aco</p>
                                <p class="font-bold text-lg text-red-600">82 <span class="text-sm font-normal">LPM</span></p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-3xl">üí®</p>
                                <p class="text-gray-600 text-sm mt-1">Presi√≥n Arterial</p>
                                <p class="font-bold text-lg text-blue-600">120/80</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-3xl">üíß</p>
                                <p class="text-gray-600 text-sm mt-1">Ox√≠geno</p>
                                <p class="font-bold text-lg text-cyan-600">98% <span class="text-sm font-normal">SpO2</span></p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-3xl">üå°Ô∏è</p>
                                <p class="text-gray-600 text-sm mt-1">Temperatura</p>
                                <p class="font-bold text-lg text-orange-600">36.8¬∞C</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                        <h4 class="font-bold text-lg mb-4">Pr√≥ximas Citas</h4>
                        <div class="space-y-4">
                            <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                                <div class="text-center border-r pr-4 mr-4">
                                    <p class="text-2xl font-bold text-blue-700">15</p>
                                    <p class="text-sm text-blue-600">Dic</p>
                                </div>
                                <div>
                                    <p class="font-semibold">Consulta de Seguimiento</p>
                                    <p class="text-sm text-gray-600">Dr. Mart√≠nez - 10:00 AM</p>
                                    <p class="text-xs text-gray-500">Hospital General, Oncolog√≠a</p>
                                </div>
                            </div>
                            <div class="flex items-center p-3 bg-blue-50 rounded-lg">
                                <div class="text-center border-r pr-4 mr-4">
                                    <p class="text-2xl font-bold text-blue-700">22</p>
                                    <p class="text-sm text-blue-600">Dic</p>
                                </div>
                                <div>
                                    <p class="font-semibold">Sesi√≥n de Quimioterapia</p>
                                    <p class="text-sm text-gray-600">Sala de Infusi√≥n - 9:00 AM</p>
                                    <p class="text-xs text-gray-500">Hospital General, Piso 2</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-1">
                        <h4 class="font-bold text-lg mb-4">Pr√≥ximos Medicamentos</h4>
                        <div class="space-y-3">
                            <div class="p-2 border-l-4 border-green-500 bg-gray-50">
                                <p class="font-semibold">Ondansetr√≥n 8mg</p>
                                <p class="text-sm text-gray-600">Pr√≥xima dosis: Hoy 11:00 AM</p>
                                <p class="text-xs font-bold text-green-600">PENDIENTE</p>
                            </div>
                            <div class="p-2 border-l-4 border-gray-400 bg-gray-50">
                                <p class="font-semibold text-gray-500">Ciclofosfamida 100mg</p>
                                <p class="text-sm text-gray-500">Tomada: Hoy 8:00 AM</p>
                                <p class="text-xs font-bold text-gray-500">ADMINISTRADO</p>
                            </div>
                            <div class="p-2 border-l-4 border-green-500 bg-gray-50">
                                <p class="font-semibold">Paracetamol 500mg</p>
                                <p class="text-sm text-gray-600">Pr√≥xima dosis: Hoy 2:00 PM</p>
                                <p class="text-xs font-bold text-green-600">PENDIENTE</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h3 class="text-xl font-bold mb-6 text-center">Estad√≠sticas del Tratamiento</h3>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-semibold text-center mb-4">Progreso del Tratamiento</h4>
                            <div class="relative h-64">
                                <canvas id="treatmentProgressChart"></canvas>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-center mb-4">Manejo de S√≠ntomas (√öltimos 7 d√≠as)</h4>
                             <div class="relative h-64">
                                <canvas id="symptomManagementChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
                    <h4 class="font-bold text-lg text-red-800 mb-4">üö® Acceso R√°pido a Emergencias</h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <button onclick="callEmergency()" class="bg-red-600 text-white p-4 rounded-lg hover:bg-red-700 transition duration-300">
                            üìû Llamar Emergencias<br>
                            <span class="text-sm">911</span>
                        </button>
                        <button onclick="requestAmbulance()" class="bg-orange-600 text-white p-4 rounded-lg hover:bg-orange-700 transition duration-300">
                            üöë Solicitar Ambulancia<br>
                            <span class="text-sm">Cruz Roja Comit√°n</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="family-emergency" class="family-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6 text-red-600">üö® Centro de Emergencias</h3>
                    
                    <div class="grid lg:grid-cols-3 gap-6 mb-8">
                        <div class="lg:col-span-2">
                             <div id="map" class="w-full h-full rounded-lg shadow-md bg-gray-200"></div>
                        </div>
                        <div>
                             <div class="bg-gray-50 p-4 rounded-lg h-full">
                                 <p id="directions-panel-info" class="text-gray-600 text-center">Seleccione un hospital en el mapa para ver la opci√≥n de ruta. Las instrucciones se abrir√°n en una nueva pesta√±a.</p>
                             </div>
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-red-50 p-6 rounded-lg border border-red-200">
                            <h4 class="font-bold text-lg mb-4">N√∫meros de Emergencia</h4>
                            <div class="space-y-3">
                                <button onclick="callNumber('911')" class="w-full bg-red-600 text-white p-3 rounded-lg hover:bg-red-700">
                                    üìû Emergencias Generales: 911
                                </button>
                                <button onclick="callNumber('963-632-0911')" class="w-full bg-orange-600 text-white p-3 rounded-lg hover:bg-orange-700">
                                    üöë Cruz Roja Comit√°n: (963) 632-0911
                                </button>
                                <button onclick="callNumber('963-632-1234')" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700">
                                    üè• Hospital General: (963) 632-1234
                                </button>
                            </div>
                        </div>

                        <div class="bg-orange-50 p-6 rounded-lg border border-orange-200">
                            <h4 class="font-bold text-lg mb-4">Servicios de Traslado</h4>
                            <div class="space-y-3">
                                <div class="p-3 bg-white rounded border">
                                    <p class="font-semibold">Ambulancias Cruz Roja</p>
                                    <p class="text-sm text-gray-600">Servicio 24/7</p>
                                    <p class="text-blue-600">üìû (963) 632-0911</p>
                                </div>
                                <div class="p-3 bg-white rounded border">
                                    <p class="font-semibold">Traslados M√©dicos Privados</p>
                                    <p class="text-sm text-gray-600">Ambulancia equipada</p>
                                    <p class="text-blue-600">üìû (963) 632-5555</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-2xl font-bold mb-6 text-center text-red-700">Protocolos de Actuaci√≥n en Emergencias</h3>
                        <div class="space-y-4">
                            <div class="border border-yellow-300 bg-yellow-50 rounded-lg p-4">
                                <h4 class="font-bold text-lg text-yellow-800 flex items-center">
                                    <span class="text-2xl mr-3">üå°Ô∏è</span> Fiebre Alta (M√°s de 38¬∞C)
                                </h4>
                                <ol class="list-decimal list-inside mt-2 space-y-1 text-gray-700">
                                    <li><strong>No administrar medicamentos</strong> para la fiebre (como paracetamol o ibuprofeno) sin antes consultar al m√©dico.</li>
                                    <li>Contactar inmediatamente al onc√≥logo tratante o al n√∫mero de emergencia del hospital.</li>
                                    <li>Mantener al paciente hidratado con agua o suero oral.</li>
                                    <li>Aflojar la ropa y mantener la habitaci√≥n a una temperatura agradable.</li>
                                    <li>Informar al m√©dico sobre cualquier otro s√≠ntoma (escalofr√≠os, tos, dolor).</li>
                                </ol>
                            </div>
                            <div class="border border-blue-300 bg-blue-50 rounded-lg p-4">
                                <h4 class="font-bold text-lg text-blue-800 flex items-center">
                                    <span class="text-2xl mr-3">üòÆ‚Äçüí®</span> Dificultad para Respirar
                                </h4>
                                <ol class="list-decimal list-inside mt-2 space-y-1 text-gray-700">
                                    <li>Llamar inmediatamente al <strong>911</strong> o solicitar una ambulancia.</li>
                                    <li>Ayudar al paciente a sentarse en una posici√≥n c√≥moda y erguida.</li>
                                    <li>Aflojar cualquier ropa apretada alrededor del cuello o el pecho.</li>
                                    <li>Si el paciente usa ox√≠geno, asegurarse de que est√© funcionando correctamente.</li>
                                    <li>Mantener la calma y tranquilizar al paciente.</li>
                                </ol>
                            </div>
                            <div class="border border-red-300 bg-red-50 rounded-lg p-4">
                                <h4 class="font-bold text-lg text-red-800 flex items-center">
                                    <span class="text-2xl mr-3">ü©∏</span> Sangrado Inusual o Abundante
                                </h4>
                                <ol class="list-decimal list-inside mt-2 space-y-1 text-gray-700">
                                    <li>Si el sangrado es severo, llamar al <strong>911</strong> inmediatamente.</li>
                                    <li>Aplicar presi√≥n directa sobre la herida con un pa√±o limpio.</li>
                                    <li>No retirar el pa√±o si se empapa de sangre; colocar otro encima y seguir presionando.</li>
                                    <li>Mantener la parte del cuerpo que sangra elevada, si es posible.</li>
                                    <li>Contactar al equipo oncol√≥gico para informar sobre la situaci√≥n.</li>
                                </ol>
                            </div>
                            <div class="border border-blue-300 bg-blue-50 rounded-lg p-4">
                                <h4 class="font-bold text-lg text-blue-800 flex items-center">
                                    <span class="text-2xl mr-3">üß†</span> Confusi√≥n S√∫bita o Cambios Mentales
                                </h4>
                                <ol class="list-decimal list-inside mt-2 space-y-1 text-gray-700">
                                    <li>No dejar al paciente solo.</li>
                                    <li>Contactar al m√©dico onc√≥logo o al servicio de emergencias de inmediato.</li>
                                    <li>Hablarle al paciente de forma calmada y clara.</li>
                                    <li>Anotar la hora en que comenzaron los s√≠ntomas y cualquier comportamiento inusual.</li>
                                    <li>Evitar darle alimentos o bebidas si tiene dificultad para tragar.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="family-status" class="family-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="text-center mb-4">
                        <h3 class="text-2xl font-bold mb-2">Estado Detallado del Paciente</h3>
                        <p class="text-lg text-gray-700 font-semibold">Mar√≠a Gonz√°lez</p>
                        <p class="text-sm text-gray-500">Diagn√≥stico: C√°ncer de Mama - Estadio II</p>
                    </div>

                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-blue-50 border border-blue-200 rounded-lg p-4">
                             <h4 class="font-bold text-lg mb-3 text-blue-800">üìù √öltima Nota del Onc√≥logo</h4>
                             <div class="mb-4">
                                 <p class="text-sm"><strong>Fecha:</strong> 03 de Septiembre, 2025</p>
                                 <p class="text-sm"><strong>Doctor:</strong> Dr. Carlos Mart√≠nez</p>
                             </div>
                             <div class="bg-white p-3 rounded-md">
                                 <p class="font-semibold text-gray-800">Resumen:</p>
                                 <p class="text-gray-700">El paciente responde bien al ciclo actual de quimioterapia. Los marcadores tumorales muestran una tendencia a la baja. Se observa fatiga moderada, lo cual es esperado.</p>
                                 <details class="mt-2 text-sm">
                                     <summary class="cursor-pointer text-blue-600 hover:underline">Ver nota completa</summary>
                                     <p class="mt-2 text-gray-600">Paciente acude a revisi√≥n post-ciclo 2 de quimioterapia AC-T. Refiere fatiga grado 2 y n√°useas leves bien controladas con Ondansetr√≥n. No ha presentado fiebre. Exploraci√≥n f√≠sica sin nuevos hallazgos. Laboratorios de control muestran leucopenia grado 1, manejable. Marcador tumoral CA 15-3 en 25 U/mL (descenso desde 35 U/mL el mes anterior). Se indica continuar con el siguiente ciclo seg√∫n lo planeado y se refuerzan signos de alarma.</p>
                                 </details>
                             </div>
                        </div>

                        <div class="lg:col-span-1">
                            <h4 class="font-bold text-lg mb-4 text-center text-gray-700">ü©∫ Signos Vitales (Hoy)</h4>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-red-100 text-red-800 p-4 rounded-lg text-center shadow-sm">
                                    <p class="text-4xl">‚ù§Ô∏è</p>
                                    <p class="text-2xl font-bold mt-2">78</p>
                                    <p class="text-sm">LPM</p>
                                </div>
                                <div class="bg-blue-100 text-blue-800 p-4 rounded-lg text-center shadow-sm">
                                    <p class="text-4xl">üí®</p>
                                    <p class="text-2xl font-bold mt-2">122/81</p>
                                    <p class="text-sm">mmHg</p>
                                </div>
                                <div class="bg-cyan-100 text-cyan-800 p-4 rounded-lg text-center shadow-sm">
                                    <p class="text-4xl">üíß</p>
                                    <p class="text-2xl font-bold mt-2">97%</p>
                                    <p class="text-sm">SpO2</p>
                                </div>
                                <div class="bg-orange-100 text-orange-800 p-4 rounded-lg text-center shadow-sm">
                                    <p class="text-4xl">üå°Ô∏è</p>
                                    <p class="text-2xl font-bold mt-2">37.1¬∞</p>
                                    <p class="text-sm">Celsius</p>
                                </div>
                                <div class="bg-blue-100 text-blue-800 p-4 rounded-lg text-center shadow-sm col-span-2">
                                    <p class="text-4xl">‚öñÔ∏è</p>
                                    <p class="text-2xl font-bold mt-2">68.5 kg</p>
                                    <p class="text-sm">Peso Corporal</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8">
                         <h3 class="text-xl font-bold mb-6 text-center">üìà Gr√°ficas de Progreso del Tratamiento</h3>
                         <div class="grid md:grid-cols-2 gap-8 bg-gray-50 p-4 rounded-lg">
                             <div>
                                 <h4 class="font-semibold text-center mb-4">Niveles de Marcador Tumoral (CA 15-3)</h4>
                                 <div class="relative h-64">
                                     <canvas id="tumorMarkerChart"></canvas>
                                 </div>
                             </div>
                             <div>
                                 <h4 class="font-semibold text-center mb-4">Puntuaci√≥n de Calidad de Vida</h4>
                                  <div class="relative h-64">
                                     <canvas id="qualityOfLifeChart"></canvas>
                                 </div>
                             </div>
                         </div>
                    </div>
                </div>
            </div>

            <div id="family-communication" class="family-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6 text-center">Centro de Comunicaci√≥n</h3>
                    
                    <div class="grid lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2">
                            <h4 class="font-bold text-xl mb-4 text-blue-800">Comunicaci√≥n con el Onc√≥logo</h4>
                            <div class="bg-gray-50 p-6 rounded-lg border">
                                <div class="flex items-center mb-6">
                                    <img src="https://placehold.co/100x100/667eea/ffffff?text=Dr.+M" alt="Foto del Dr. Mart√≠nez" class="w-24 h-24 rounded-full mr-6 border-4 border-white shadow-md">
                                    <div>
                                        <p class="font-bold text-2xl text-gray-800">Dr. Carlos Mart√≠nez</p>
                                        <p class="text-md text-gray-600">Onc√≥logo M√©dico Principal</p>
                                        <p class="text-sm text-green-600 mt-1 font-semibold">üü¢ Disponible para consultas</p>
                                    </div>
                                </div>
                                <div class="grid md:grid-cols-2 gap-4 mb-6">
                                    <button onclick="secureMessage()" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 flex items-center justify-center space-x-2 transition">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" /><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" /></svg>
                                        <span>Enviar Mensaje Seguro</span>
                                    </button>
                                    <button onclick="requestVideoCall()" class="w-full bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 flex items-center justify-center space-x-2 transition">
                                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2-2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 001.553.832l3-2a1 1 0 000-1.664l-3-2z" /></svg>
                                        <span>Solicitar Videollamada</span>
                                    </button>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-gray-700 mb-2">√öltima Comunicaci√≥n (Ayer, 4:30 PM)</h5>
                                    <div class="bg-white p-4 rounded-md border text-sm">
                                        <p><strong>Dr. Mart√≠nez:</strong> <em>"Buenas tardes. Los resultados de los √∫ltimos an√°lisis de sangre son estables. Continuaremos con el plan actual. Por favor, vigilen la fatiga y aseg√∫rense de que se mantenga bien hidratada. Cualquier cambio, no duden en contactarme."</em></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-1 space-y-8">
                             <div>
                                <h4 class="font-bold text-xl mb-4 text-blue-800">Contacto del Hospital</h4>
                                <div class="bg-gray-50 p-6 rounded-lg border">
                                     <p class="font-bold text-lg text-gray-800">Hospital General de Comit√°n</p>
                                     <div class="space-y-3 mt-4">
                                          <div class="flex items-center justify-between">
                                              <span>üìû Centralita</span>
                                              <button onclick="callNumber('963-632-1234')" class="bg-gray-200 text-gray-800 px-3 py-1 rounded-md text-sm hover:bg-gray-300">Llamar</button>
                                          </div>
                                          <div class="flex items-center justify-between">
                                              <span>ü©∫ Dept. Oncolog√≠a</span>
                                              <button onclick="callNumber('963-632-1234', '205')" class="bg-gray-200 text-gray-800 px-3 py-1 rounded-md text-sm hover:bg-gray-300">Llamar</button>
                                          </div>
                                           <div class="flex items-center justify-between">
                                              <span>ü§ù Trabajo Social</span>
                                              <button onclick="callNumber('963-632-1234', '112')" class="bg-gray-200 text-gray-800 px-3 py-1 rounded-md text-sm hover:bg-gray-300">Llamar</button>
                                          </div>
                                           <div class="flex items-center justify-between">
                                              <span>üíä Farmacia</span>
                                              <button onclick="callNumber('963-632-1234', '150')" class="bg-gray-200 text-gray-800 px-3 py-1 rounded-md text-sm hover:bg-gray-300">Llamar</button>
                                          </div>
                                     </div>
                                </div>
                             </div>

                             <div>
                                <h4 class="font-bold text-xl mb-4 text-blue-800">üìÑ Datos Importantes del Paciente</h4>
                                <div class="bg-gray-50 p-6 rounded-lg border space-y-3">
                                     <div class="flex justify-between text-sm">
                                         <span class="text-gray-600">No. Expediente:</span>
                                         <span class="font-semibold text-gray-800">MG-789456123</span>
                                     </div>
                                     <div class="flex justify-between text-sm">
                                         <span class="text-gray-600">Tipo de Sangre:</span>
                                         <span class="font-semibold text-gray-800">O+</span>
                                     </div>
                                     <div class="flex justify-between text-sm">
                                         <span class="text-gray-600">Alergias:</span>
                                         <span class="font-semibold text-red-600">Penicilina</span>
                                     </div>
                                     <div class="flex justify-between text-sm">
                                         <span class="text-gray-600">Contacto Primario:</span>
                                         <span id="primaryContact" class="font-semibold text-gray-800">[Tu Nombre]</span>
                                     </div>
                                </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="family-calendar" class="family-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6 text-center">Calendario de Citas y Tratamientos</h3>
                    <div class="grid lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2">
                            <div class="bg-gray-50 p-4 rounded-lg border">
                                <div class="flex justify-between items-center mb-4">
                                    <button onclick="previousMonth()" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                                    </button>
                                    <h4 id="monthAndYear" class="text-xl font-bold"></h4>
                                    <button onclick="nextMonth()" class="p-2 rounded-full hover:bg-gray-200 transition-colors">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                    </button>
                                </div>
                                <div class="grid grid-cols-7 gap-1 text-center font-semibold text-gray-600 mb-2">
                                    <div>Dom</div>
                                    <div>Lun</div>
                                    <div>Mar</div>
                                    <div>Mi√©</div>
                                    <div>Jue</div>
                                    <div>Vie</div>
                                    <div>S√°b</div>
                                </div>
                                <div id="calendar-body" class="grid grid-cols-7 gap-1">
                                </div>
                            </div>
                        </div>
                        <div class="lg:col-span-1">
                             <div class="bg-gray-50 p-4 rounded-lg border h-full">
                                <h4 class="font-bold text-lg mb-4 text-center text-gray-700">Eventos del D√≠a</h4>
                                <div id="appointment-details" class="min-h-[200px]">
                                   <p class="text-gray-500 text-center mt-4">Seleccione un d√≠a del calendario para ver los detalles.</p>
                                </div>
                                <hr class="my-4 border-t border-gray-200">
                                <h4 class="font-bold text-lg mb-4 text-center text-gray-700">Datos del Mes</h4>
                                <div id="calendar-summary" class="space-y-3">
                                   </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

             <div id="family-directory" class="family-section hidden">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-2xl font-bold mb-6 text-center">Directorio de Especialistas - Comit√°n</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/667eea/ffffff?text=Dr.+M" alt="Foto del Dr. Mart√≠nez" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Dr. Carlos Mart√≠nez</p>
                                <p class="text-sm font-semibold text-blue-600">Onc√≥logo M√©dico</p>
                                <p class="text-sm text-gray-600 mt-1">üìç Carr. Comit√°n - La Trinitaria Km. 1272</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> L-V 9:00 AM - 5:00 PM</p>
                                    <p><strong>Contacto:</strong> (963) 632-0150 Ext. 205</p>
                                    <p><strong>Urgencias:</strong> (963) 123-4567</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/764ba2/ffffff?text=Dra.+R" alt="Foto de la Dra. Rodr√≠guez" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Dra. Ana Rodr√≠guez</p>
                                <p class="text-sm font-semibold text-blue-600">Oncolog√≠a Cl√≠nica</p>
                                <p class="text-sm text-gray-600 mt-1">üìç Av. Central Pte. #15, Centro</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> L, M, J 10:00 AM - 6:00 PM</p>
                                    <p><strong>Contacto:</strong> (963) 632-9876</p>
                                    <p><strong>Urgencias:</strong> (963) 987-6543</p>
                                </div>
                            </div>
                        </div>
                        
                         <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/10B981/ffffff?text=Dr.+H" alt="Foto del Dr. Hern√°ndez" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Dr. Luis Hern√°ndez</p>
                                <p class="text-sm font-semibold text-green-600">Psico-oncolog√≠a</p>
                                <p class="text-sm text-gray-600 mt-1">üìç 2a Calle Sur Pte. #28, San Sebasti√°n</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> M, J, V 4:00 PM - 8:00 PM</p>
                                    <p><strong>Contacto:</strong> (963) 632-5678</p>
                                    <p><strong>Urgencias:</strong> Contactar v√≠a hospital</p>
                                </div>
                            </div>
                        </div>
                        
                         <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/F59E0B/ffffff?text=Lic.+F" alt="Foto de la Lic. Flores" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Lic. Mar√≠a Flores</p>
                                <p class="text-sm font-semibold text-yellow-600">Nutrici√≥n Oncol√≥gica</p>
                                <p class="text-sm text-gray-600 mt-1">üìç Blvd. Dr. Belisario Dom√≠nguez #123</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> Previa Cita</p>
                                    <p><strong>Contacto:</strong> (963) 632-7777</p>
                                    <p><strong>Urgencias:</strong> N/A</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/EF4444/ffffff?text=Dr.+S" alt="Foto del Dr. Sol√≠s" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Dr. Javier Sol√≠s</p>
                                <p class="text-sm font-semibold text-red-600">Radioterapia Oncol√≥gica</p>
                                <p class="text-sm text-gray-600 mt-1">üìç Carr. Comit√°n - La Trinitaria Km. 1272</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> L-V 8:00 AM - 4:00 PM</p>
                                    <p><strong>Contacto:</strong> (963) 632-1234 Ext. 310</p>
                                    <p><strong>Urgencias:</strong> Acudir a Urgencias del Hospital</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/3B82F6/ffffff?text=Dra.+C" alt="Foto de la Dra. Cruz" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Dra. Elena Cruz</p>
                                <p class="text-sm font-semibold text-indigo-600">Cuidados Paliativos</p>
                                <p class="text-sm text-gray-600 mt-1">üìç Base en Hospital General</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> 24/7 (Guardias)</p>
                                    <p><strong>Contacto:</strong> (963) 111-2233</p>
                                    <p><strong>Urgencias:</strong> Mismo n√∫mero de contacto</p>
                                </div>
                            </div>
                        </div>
                        
                         <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/14B8A6/ffffff?text=Lic.+D" alt="Foto del Lic. Dom√≠nguez" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Lic. Roberto Dom√≠nguez</p>
                                <p class="text-sm font-semibold text-teal-600">Fisioterapia Oncol√≥gica</p>
                                <p class="text-sm text-gray-600 mt-1">üìç 5a Av. Pte. Sur #45, Guadalupe</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> Previa Cita</p>
                                    <p><strong>Contacto:</strong> (963) 444-5566</p>
                                    <p><strong>Urgencias:</strong> N/A</p>
                                </div>
                            </div>
                        </div>
                        
                         <div class="bg-gray-50 border rounded-lg p-4 flex items-start space-x-4">
                            <img src="https://placehold.co/80x80/D946EF/ffffff?text=Lic.+M" alt="Foto de la Lic. Morales" class="w-20 h-20 rounded-full border-2 border-white shadow-md">
                            <div class="flex-1">
                                <p class="font-bold text-lg text-gray-800">Lic. Sofia Morales</p>
                                <p class="text-sm font-semibold text-fuchsia-600">Trabajo Social</p>
                                <p class="text-sm text-gray-600 mt-1">üìç Hospital General, Oficina 1B</p>
                                <div class="text-xs text-gray-500 mt-2">
                                    <p><strong>Horario:</strong> L-V 8:00 AM - 3:00 PM</p>
                                    <p><strong>Contacto:</strong> (963) 632-1234 Ext. 112</p>
                                    <p><strong>Urgencias:</strong> N/A</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div id="videoCallModal" class="hidden fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 text-white rounded-2xl shadow-2xl w-full max-w-4xl h-full max-h-[90vh] flex flex-col">
            <div class="flex-1 relative flex items-center justify-center bg-gray-900 rounded-t-2xl">
                <div class="text-center">
                    <img src="https://placehold.co/120x120/667eea/ffffff?text=Dr.+M" alt="Foto del Dr. Mart√≠nez" class="w-32 h-32 rounded-full mx-auto border-4 border-gray-700">
                    <h3 class="text-2xl font-bold mt-4">Dr. Carlos Mart√≠nez</h3>
                    <p class="text-blue-300">Conectado</p>
                </div>
                <div id="callTimerDisplay" class="absolute top-4 left-4 bg-black bg-opacity-50 px-3 py-1 rounded-full text-lg font-mono">
                    00:00
                </div>
                <div class="absolute bottom-6 right-6 w-48 h-36 bg-gray-700 rounded-lg border-2 border-white shadow-lg flex items-center justify-center">
                    <div class="text-center">
                         <span class="text-4xl">üë§</span>
                        <p id="pipUserName" class="text-sm font-semibold mt-2">Tu Video</p>
                    </div>
                </div>
            </div>
            <div class="bg-gray-900 p-4 rounded-b-2xl">
                <div class="flex justify-center items-center space-x-4">
                    <button onclick="toggleMic()" class="w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center text-2xl transition"><span id="micIcon">üé§</span></button>
                    <button onclick="toggleCam()" class="w-16 h-16 bg-gray-700 hover:bg-gray-600 rounded-full flex items-center justify-center text-2xl transition"><span id="camIcon">üìπ</span></button>
                    <button onclick="endVideoCallSimulation()" class="w-20 h-16 bg-red-600 hover:bg-red-700 rounded-full flex items-center justify-center text-2xl transition">üìû</button>
                </div>
            </div>
        </div>
    </div>
    
     <div id="ambulanceModal" class="hidden fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4">
        <div id="ambulanceRequest" class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Confirmar Solicitud de Ambulancia</h3>
            <div class="w-24 h-24 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-5xl">üöë</span>
            </div>
            <p class="text-gray-600 mb-6">¬øEst√°s seguro de que deseas solicitar una ambulancia de la Cruz Roja a tu ubicaci√≥n actual? Esto es solo para emergencias reales.</p>
            <div class="flex justify-center space-x-4">
                <button onclick="hideAmbulanceModal()" class="px-6 py-2 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-800">Cancelar</button>
                <button onclick="confirmAmbulance()" class="px-6 py-2 rounded-lg bg-orange-600 hover:bg-orange-700 text-white">S√≠, Confirmar</button>
            </div>
        </div>
        <div id="ambulanceConfirmed" class="hidden bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center">
             <h3 class="text-2xl font-bold text-green-600 mb-4">Ambulancia en Camino</h3>
             <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                 <span class="text-5xl animate-pulse">üöë</span>
             </div>
             <p class="text-gray-600 mb-2">La unidad de la Cruz Roja ha sido notificada y se dirige a tu ubicaci√≥n.</p>
             <p class="text-lg font-bold text-gray-800">Tiempo estimado de llegada: <span class="text-green-600">8-12 minutos</span>.</p>
             <p class="text-sm text-gray-500 mt-4">Por favor, mant√©n la l√≠nea telef√≥nica abierta y despeja el acceso a la entrada.</p>
             <button onclick="hideAmbulanceModal()" class="mt-6 w-full px-6 py-2 rounded-lg bg-gray-300 hover:bg-gray-400 text-gray-800">Entendido</button>
        </div>
    </div>

    <div id="emergencyCallModal" class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center">
        <div class="bg-gray-800 text-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center">
            <h3 class="text-2xl font-bold mb-4">Llamada de Emergencia</h3>
            <div class="w-24 h-24 bg-red-500 border-4 border-red-400 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                <span class="text-5xl">üìû</span>
            </div>
            <p id="callStatusText" class="text-xl text-yellow-300 mb-2">Llamando a 911...</p>
            <p id="callTimer" class="text-3xl font-mono mb-6">00:00</p>
            <button onclick="endEmergencyCall()" class="w-full px-6 py-3 rounded-lg bg-red-600 hover:bg-red-700 text-white font-bold">Finalizar Llamada</button>
        </div>
    </div>


    <script>
        let currentUserType = '';
        let currentUser = '';
        let tumorMarkerChart = null;
        let qualityOfLifeChart = null;
        let currentDate = new Date('2025-09-09T09:52:00-06:00');

        const appointmentTypes = {
            'consulta': { 
                color: 'blue', 
                icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>`
            },
            'quimio': { 
                color: 'blue', 
                icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V3a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>`
            },
            'estudio': { 
                color: 'green', 
                icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>`
            }
        };

        const appointments = [
            { date: '2025-09-15', time: '10:00 AM', title: 'Consulta de Seguimiento', location: 'Hospital General, Oncolog√≠a', doctor: 'Dr. Mart√≠nez', type: 'consulta' },
            { date: '2025-09-22', time: '09:00 AM', title: 'Sesi√≥n de Quimioterapia', location: 'Hospital General, Sala de Infusi√≥n', doctor: 'Equipo de Enfermer√≠a', type: 'quimio' },
            { date: '2025-09-22', time: '02:00 PM', title: 'Toma de Muestra Sangu√≠nea', location: 'Laboratorio Cl√≠nico', doctor: 'N/A', type: 'estudio' },
            { date: '2025-10-01', time: '11:30 AM', title: 'Consulta Nutricional', location: 'Consultorio Privado', doctor: 'Lic. Mar√≠a Flores', type: 'consulta' },
            { date: '2025-08-25', time: '09:00 AM', title: 'Sesi√≥n de Quimioterapia (Pasada)', location: 'Hospital General, Sala de Infusi√≥n', doctor: 'Equipo de Enfermer√≠a', type: 'quimio' },
        ];


        function showLogin(userType) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            currentUserType = userType;
            document.getElementById('loginTitle').textContent = 'Acceso Familiar';
        }

        function backToSelection() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username && password) {
                currentUser = username;
                document.getElementById('userName').textContent = `Bienvenido, ${username}`;
                document.getElementById('userInfo').classList.remove('hidden');
                document.getElementById('primaryContact').textContent = username;

                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('loginScreen').classList.add('hidden');
                
                document.getElementById('familyDashboard').classList.remove('hidden');
                initializeFamilyCharts();
            }
        }

        function logout() {
            document.getElementById('familyDashboard').classList.add('hidden');
            document.getElementById('userInfo').classList.add('hidden');
            
            document.getElementById('loginScreen').classList.remove('hidden');
            
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            currentUser = '';
            currentUserType = '';
        }

        function showFamilySection(section) {
            document.querySelectorAll('.family-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`family-${section}`).classList.remove('hidden');
            
            document.querySelectorAll('.family-nav-btn').forEach(btn => {
                btn.classList.remove('bg-blue-600', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('bg-blue-600', 'text-white');
            
            if (section === 'emergency') {
                initLeafletMap();
            }
            if (section === 'status') {
                initializeStatusCharts();
            }
            if (section === 'calendar') {
                renderCalendar();
            }
        }

        let emergencyCallTimerInterval = null;
        let emergencyCallSeconds = 0;

        function callEmergency() {
            const modal = document.getElementById('emergencyCallModal');
            modal.classList.remove('hidden');

            emergencyCallSeconds = 0;
            document.getElementById('callTimer').textContent = '00:00';
            const statusText = document.getElementById('callStatusText');
            statusText.textContent = 'Llamando a 911...';
            statusText.classList.add('text-yellow-300');
            statusText.classList.remove('text-green-300');


            setTimeout(() => {
                statusText.textContent = 'Conectado';
                statusText.classList.remove('text-yellow-300');
                statusText.classList.add('text-green-300');
                
                if (emergencyCallTimerInterval) clearInterval(emergencyCallTimerInterval);
                emergencyCallTimerInterval = setInterval(() => {
                    emergencyCallSeconds++;
                    const minutes = Math.floor(emergencyCallSeconds / 60).toString().padStart(2, '0');
                    const seconds = (emergencyCallSeconds % 60).toString().padStart(2, '0');
                    document.getElementById('callTimer').textContent = `${minutes}:${seconds}`;
                }, 1000);
            }, 2000);
        }
        
        function endEmergencyCall() {
             const modal = document.getElementById('emergencyCallModal');
             modal.classList.add('hidden');
             if(emergencyCallTimerInterval) clearInterval(emergencyCallTimerInterval);
             alert("Llamada de emergencia finalizada.");
        }

        function requestAmbulance() {
            const modal = document.getElementById('ambulanceModal');
            document.getElementById('ambulanceRequest').classList.remove('hidden');
            document.getElementById('ambulanceConfirmed').classList.add('hidden');
            modal.classList.remove('hidden');
        }

        function confirmAmbulance() {
             document.getElementById('ambulanceRequest').classList.add('hidden');
             document.getElementById('ambulanceConfirmed').classList.remove('hidden');
        }

        function hideAmbulanceModal() {
             document.getElementById('ambulanceModal').classList.add('hidden');
        }


        function callNumber(number, extension = null) {
            let alertMessage = `üìû Llamando al ${number}...`;
            if (extension) {
                alertMessage += `\nMarque la extensi√≥n: ${extension}`;
            }
            alertMessage += "\n\nEn una aplicaci√≥n real, esto iniciar√≠a la llamada.";
            alert(alertMessage);
        }

        function secureMessage() {
            alert("Abriendo canal de mensajer√≠a segura con el Dr. Mart√≠nez...\n\nEn una aplicaci√≥n real, esto abrir√≠a una interfaz de chat encriptado para comunicarse directamente con el m√©dico.");
        }

        let callTimerInterval = null;
        let callSeconds = 0;
        let isMicMuted = false;
        let isCamOff = false;

        function requestVideoCall() {
            alert("Iniciando simulaci√≥n de videollamada con el Dr. Mart√≠nez...");
            setTimeout(startVideoCallSimulation, 1000);
        }

        function startVideoCallSimulation() {
            const modal = document.getElementById('videoCallModal');
            const pipUserName = document.getElementById('pipUserName');
            pipUserName.textContent = currentUser || "T√∫";

            modal.classList.remove('hidden');
            
            callSeconds = 0;
            document.getElementById('callTimerDisplay').textContent = '00:00';
            if (callTimerInterval) clearInterval(callTimerInterval);

            callTimerInterval = setInterval(() => {
                callSeconds++;
                const minutes = Math.floor(callSeconds / 60).toString().padStart(2, '0');
                const seconds = (callSeconds % 60).toString().padStart(2, '0');
                document.getElementById('callTimerDisplay').textContent = `${minutes}:${seconds}`;
            }, 1000);
            
            isMicMuted = false;
            isCamOff = false;
            document.getElementById('micIcon').textContent = 'üé§';
            document.getElementById('camIcon').textContent = 'üìπ';
        }

        function endVideoCallSimulation() {
            const modal = document.getElementById('videoCallModal');
            modal.classList.add('hidden');
            if (callTimerInterval) clearInterval(callTimerInterval);
            
            const duration = document.getElementById('callTimerDisplay').textContent;
            alert(`Videollamada finalizada.\n\nDuraci√≥n: ${duration}`);
        }

        function toggleMic() {
            isMicMuted = !isMicMuted;
            document.getElementById('micIcon').textContent = isMicMuted ? 'üîá' : 'üé§';
            alert(isMicMuted ? "Micr√≥fono silenciado" : "Micr√≥fono activado");
        }

        function toggleCam() {
            isCamOff = !isCamOff;
            document.getElementById('camIcon').textContent = isCamOff ? 'üì∑' : 'üìπ';
            alert(isCamOff ? "C√°mara desactivada" : "C√°mara activada");
        }


        function initializeFamilyCharts() {
            const ctxProgress = document.getElementById('treatmentProgressChart').getContext('2d');
            new Chart(ctxProgress, {
                type: 'line',
                data: {
                    labels: ['Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
                    datasets: [{
                        label: 'Nivel de Bienestar (Reportado)',
                        data: [6, 7, 7, 8, 7, 9],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                             callbacks: {
                                label: function(context) {
                                    return `Bienestar: ${context.parsed.y} de 10`;
                                }
                            }
                        }
                    }
                }
            });

            const ctxSymptoms = document.getElementById('symptomManagementChart').getContext('2d');
            new Chart(ctxSymptoms, {
                type: 'bar',
                data: {
                    labels: ['Fatiga', 'N√°useas', 'Dolor', 'Falta de Apetito', 'Ansiedad'],
                    datasets: [{
                        label: 'D√≠as con S√≠ntoma Reportado',
                        data: [5, 2, 3, 4, 1],
                        backgroundColor: [
                            'rgba(245, 158, 11, 0.6)',
                            'rgba(239, 68, 68, 0.6)',
                            'rgba(236, 72, 153, 0.6)',
                            'rgba(16, 185, 129, 0.6)',
                            'rgba(59, 130, 246, 0.6)'
                        ],
                        borderColor: [
                            '#F59E0B',
                            '#EF4444',
                            '#EC4899',
                            '#10B981',
                            '#3B82F6'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                     scales: {
                        x: {
                            beginAtZero: true,
                            max: 7,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function initializeStatusCharts() {
            if (tumorMarkerChart) {
                tumorMarkerChart.destroy();
            }
            if (qualityOfLifeChart) {
                qualityOfLifeChart.destroy();
            }

            const ctxTumor = document.getElementById('tumorMarkerChart').getContext('2d');
            tumorMarkerChart = new Chart(ctxTumor, {
                type: 'line',
                data: {
                    labels: ['Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep'],
                    datasets: [{
                        label: 'Nivel de CA 15-3 (U/mL)',
                        data: [45, 40, 38, 35, 29, 25],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'U/mL'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                           display: false
                        }
                    }
                }
            });

            const ctxQOL = document.getElementById('qualityOfLifeChart').getContext('2d');
            qualityOfLifeChart = new Chart(ctxQOL, {
                type: 'radar',
                data: {
                    labels: ['Bienestar F√≠sico', 'Bienestar Emocional', 'Actividad Social', 'Manejo del Dolor', 'Apetito'],
                    datasets: [{
                        label: 'Mes Pasado',
                        data: [6, 7, 5, 6, 5],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Mes Actual',
                        data: [7, 8, 7, 8, 6],
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: {
                                stepSize: 2
                            }
                        }
                    }
                }
            });
        }

        let map;
        let userLocation = null;

        function initLeafletMap() {
            if (map) {
                map.invalidateSize();
                return;
            }

            const comitanCoords = [16.2519, -92.1331];
            map = L.map('map').setView(comitanCoords, 14);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            const locations = [
                 {
                    position: { lat: 16.2485, lng: -92.1352 },
                    title: 'Hospital General De Comitan "Maria Ignacia Gandulfo"'
                },
                {
                    position: { lat: 16.2371, lng: -92.1281 },
                    title: 'IMSS Hospital General de Zona No. 2'
                },
                {
                    position: { lat: 16.2550, lng: -92.1300 },
                    title: 'Cl√≠nica San Jos√© (Ejemplo)'
                },
                {
                    position: { lat: 16.2500, lng: -92.1380 },
                    title: 'Centro M√©dico Especializado (Ejemplo)'
                },
            ];

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = [position.coords.latitude, position.coords.longitude];
                    const userIcon = L.divIcon({
                        html: 'üìç',
                        className: 'text-2xl',
                        iconSize: [24, 24],
                        iconAnchor: [12, 24]
                    });
                    L.marker(userLocation, { icon: userIcon }).addTo(map)
                        .bindPopup('<b>Tu Ubicaci√≥n</b>')
                        .openPopup();
                    map.setView(userLocation, 14);
                },
                () => {
                    alert("No se pudo obtener tu ubicaci√≥n. Las rutas se generar√°n desde el centro de Comit√°n.");
                    userLocation = comitanCoords;
                }
            );
            
            const hospitalIcon = L.divIcon({
                html: 'üè•',
                className: 'text-3xl',
                iconSize: [30, 30],
                iconAnchor: [15, 30]
            });

            locations.forEach(location => {
                const marker = L.marker([location.position.lat, location.position.lng], { icon: hospitalIcon }).addTo(map);
                const popupContent = `
                    <div class="p-1">
                        <h3 class="font-bold text-base">${location.title}</h3>
                        <button onclick="getLeafletDirections(${location.position.lat}, ${location.position.lng})" class="mt-2 w-full bg-blue-600 text-white px-3 py-1 rounded-lg text-sm hover:bg-blue-700">
                            C√≥mo llegar
                        </button>
                    </div>
                `;
                marker.bindPopup(popupContent);
            });
        }

        function getLeafletDirections(destLat, destLng) {
            if (!userLocation) {
                alert("Esperando para obtener tu ubicaci√≥n. Por favor, intenta de nuevo en un momento.");
                return;
            }
            const url = `https://www.openstreetmap.org/directions?route=${userLocation[0]}%2C${userLocation[1]}%3B${destLat}%2C${destLng}`;
            window.open(url, '_blank');
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            document.getElementById('monthAndYear').textContent = `${currentDate.toLocaleString('es-ES', { month: 'long' })} ${year}`;

            const calendarBody = document.getElementById('calendar-body');
            calendarBody.innerHTML = '';

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            for (let i = 0; i < firstDay; i++) {
                const cell = document.createElement('div');
                calendarBody.appendChild(cell);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const cell = document.createElement('div');
                cell.className = 'p-2 h-20 border rounded-lg flex flex-col items-center justify-start cursor-pointer hover:bg-gray-100 relative';
                
                const dayNumber = document.createElement('span');
                dayNumber.textContent = day;
                cell.appendChild(dayNumber);
                
                const today = new Date();
                if (day === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {
                    dayNumber.classList.add('bg-blue-600', 'text-white', 'rounded-full', 'w-6', 'h-6', 'flex', 'items-center', 'justify-center');
                }

                const dateString = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const dayAppointments = appointments.filter(app => app.date === dateString);

                if (dayAppointments.length > 0) {
                     const dotsContainer = document.createElement('div');
                     dotsContainer.className = 'absolute bottom-2 flex space-x-1';
                    
                     const typesOfTheDay = [...new Set(dayAppointments.map(a => a.type))];
                    
                     typesOfTheDay.forEach(type => {
                         const dot = document.createElement('span');
                         const typeInfo = appointmentTypes[type] || { color: 'gray' };
                         dot.className = `w-2 h-2 bg-${typeInfo.color}-500 rounded-full`;
                         dotsContainer.appendChild(dot);
                     });

                     cell.appendChild(dotsContainer);
                     cell.onclick = () => showAppointments(day, month, year);
                } else {
                     cell.onclick = () => showAppointments(day, month, year);
                }
                
                calendarBody.appendChild(cell);
            }
            updateCalendarSummary(year, month);
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }
        
        function showAppointments(day, month, year) {
            const detailsPanel = document.getElementById('appointment-details');
            const dateString = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            const dayAppointments = appointments.filter(app => app.date === dateString);

            detailsPanel.innerHTML = '';

            const header = document.createElement('h5');
            header.className = 'font-bold text-center mb-4';
            header.textContent = `Eventos para el ${day} de ${currentDate.toLocaleString('es-ES', { month: 'long' })}`;
            detailsPanel.appendChild(header);

            if (dayAppointments.length > 0) {
                const list = document.createElement('div');
                list.className = 'space-y-3';
                
                dayAppointments.forEach(app => {
                    const typeInfo = appointmentTypes[app.type] || { color: 'gray', icon: '' };
                    const appointmentEl = document.createElement('div');
                    appointmentEl.className = `p-3 bg-white rounded-lg border-l-4 border-${typeInfo.color}-500 flex items-start space-x-3`;
                    appointmentEl.innerHTML = `
                        <div class="flex-shrink-0 text-${typeInfo.color}-500 mt-1">${typeInfo.icon}</div>
                        <div>
                            <p class="font-semibold text-gray-800">${app.title}</p>
                            <p class="text-sm text-gray-600">${app.time}</p>
                            <p class="text-xs text-gray-500">${app.location}</p>
                            <p class="text-xs text-gray-500"><strong>M√©dico:</strong> ${app.doctor}</p>
                        </div>
                    `;
                    list.appendChild(appointmentEl);
                });
                detailsPanel.appendChild(list);
            } else {
                const noEvents = document.createElement('p');
                noEvents.className = 'text-gray-500 text-center mt-4';
                noEvents.textContent = 'No hay citas ni eventos programados para este d√≠a.';
                detailsPanel.appendChild(noEvents);
            }
        }

        function updateCalendarSummary(year, month) {
            const summaryPanel = document.getElementById('calendar-summary');
            const today = new Date();
            today.setHours(0,0,0,0);

            const monthAppointments = appointments.filter(app => {
                const appDate = new Date(app.date + 'T00:00:00');
                return appDate.getFullYear() === year && appDate.getMonth() === month;
            });

            const upcomingAppointments = monthAppointments
                .filter(app => new Date(app.date + 'T00:00:00') >= today)
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            let summaryHTML = `
                <div class="flex items-center text-sm text-gray-700">
                    <span class="w-8 text-center mr-2 text-xl">üóìÔ∏è</span>
                    <span>${monthAppointments.length} evento(s) este mes.</span>
                </div>
            `;
            
            if (upcomingAppointments.length > 0) {
                const nextApp = upcomingAppointments[0];
                const nextAppDate = new Date(nextApp.date + 'T12:00:00');
                const typeInfo = appointmentTypes[nextApp.type];

                summaryHTML += `
                    <div class="flex items-start text-sm mt-2 text-gray-700">
                        <div class="w-8 text-center mr-2 text-xl text-${typeInfo.color}-500">${typeInfo.icon}</div>
                        <div>
                            <strong>Pr√≥xima cita:</strong> ${nextApp.title} el ${nextAppDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })}.
                        </div>
                    </div>
                `;
            } else {
                 summaryHTML += `
                    <div class="flex items-center text-sm mt-2 text-gray-700">
                        <span class="w-8 text-center mr-2 text-xl">‚úîÔ∏è</span>
                        <span>No hay m√°s citas programadas este mes.</span>
                    </div>
                `;
            }
            
            summaryPanel.innerHTML = summaryHTML;
        }

    </script>
</body>
</html>

<footer class="bg-gray-800 text-white py-12">
    <div class="container mx-auto px-6">
        <div class="grid md:grid-cols-4 gap-8">
            <div>
                <div class="flex items-center space-x-3 mb-4">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-bold">J</span>
                    </div>
                    <h4 class="text-xl font-bold">Jarelux</h4>
                </div>
                <p class="text-gray-400">Conectando pacientes con c√°ncer con descuentos que marcan la diferencia en su tratamiento.</p>
            </div>
            <div>
                <h5 class="font-semibold mb-4">Servicios</h5>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-white transition-colors">Farmacias</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Cl√≠nicas</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Hospitales</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Laboratorios</a></li>
                </ul>
            </div>
            <div>
                <h5 class="font-semibold mb-4">Soporte</h5>
                <ul class="space-y-2 text-gray-400">
                    <li><a href="#" class="hover:text-white transition-colors">Centro de Ayuda</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Preguntas Frecuentes</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">Contacto</a></li>
                    <li><a href="#" class="hover:text-white transition-colors">T√©rminos y Condiciones</a></li>
                </ul>
            </div>
            <div>
                <h5 class="font-semibold mb-4">Contacto</h5>
                <div class="space-y-2 text-gray-400">
                    <p>üìû 01-800-JARELUX</p>
                    <p>‚úâÔ∏è info@jarelux.com</p>
                    <p>üìç Ciudad de M√©xico, M√©xico</p>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-400">
            <p>&copy; 2025 Jarelux. Todos los derechos reservados.</p>
        </div>
    </div>
</footer>
